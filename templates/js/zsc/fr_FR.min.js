(function(){var d="onModuleReady",a=window,c=Object.prototype.hasOwnProperty.call(a,d),b=a[d],e;a[d]=function(g,h){a[d]=b;if(!c){try{delete a[d]}catch(f){}}e=setInterval(function(){var j;try{j=Zynga.ns.Channels[g]}catch(i){}if(j){clearInterval(e);h(j)}},150)}}());onModuleReady("ZSC",function(a){var b=a.validator;b.define("GameMessageData",{type:"object",properties:{image:{type:"string"},body:{type:"string"}}});b.define("GameMessageMetadata",{type:"object",properties:{sender:{required:true,type:"string"},timestamp:{required:true,spec:"timestamp"},type:{required:true,type:"string"},subtype:{required:true,type:"string"},subtype_aggregate:{type:"string"},preventAggregation:{type:"boolean"},expired:{type:"boolean"},type_text:{type:"string"}}});b.define("GameMessage",{type:"object",properties:{data:{required:true,type:"array",each:{spec:"GameMessageData"}},metadata:{required:true,spec:"GameMessageMetadata"}}});a.once(["DAPI","SNAPI","snid","$"],function(g,c,e,f){var h={locale:null,rawData:null,instance:null,init:function(i,j){if(h.instance){h.merge(i,j);return}h.locale=i;h.rawData=j;h.instance=new h.Localizer(i,j)},merge:function(i,j){if(i!=h.locale){throw new Error("cannot merge "+i+" with "+h.locale)}h.instance.merge(j)},t:function(i,j,k){return h.instance.t(i,j,k)},tk:function(j,k,i,l){return h.instance.tk(j,k,i,l)},tn:function(i,j){return h.instance.tn(i,j)},ti:function(i){return h.instance.translateImagePath(i)},timeAgoInWords:function(){return h.Formatter.timeAgoInWords.apply(null,arguments)},formatList:function(){return h.Formatter.formatList.apply(null,arguments)},sort:function(i){return h.instance.sort(i)}};var d={arrayDiff:function(l,k){var n={};var q=[];for(var p=0;p<l.length;p++){n[l[p]]=true}for(var m=0;m<k.length;m++){if(n[k[m]]){delete n[k[m]]}else{q.push(k[m])}}for(var o in n){if(n.hasOwnProperty(o)){q.push(o)}}return q},arrayIntersect:function(l,k){var p=[];var m={};for(var o=0;o<l.length;++o){m[l[o]]=true}for(var n=0;n<k.length;++n){if(m[k[n]]){p.push(k[n])}}return p},extend:function(){if(arguments.length<2){return}var l=arguments[0];for(var j=1;j<arguments.length;++j){for(var k in arguments[j]){if(arguments[j].hasOwnProperty(k)){l[k]=arguments[j][k]}}}}};h.LocalizationToken=function(){this.m_attributes=[]};h.LocalizationToken.prototype={filterIndexes:function(k){var j=[];for(var l=0;l<k.length;++l){var m=d.arrayDiff(this.m_attributes,k[l]);if(!m.length){j.push(l)}else{if(m.length==1&&h.LocalizationObjectToken.GENDERS.hasOwnProperty(m[0])&&(this instanceof h.LocalizationName)){j.push(l)}}}return j},addAttributes:function(i){this.m_attributes=this.m_attributes.concat(i)},getString:function(){throw new Error("Must override")}};h.LocalizationObjectToken=function(i,j,k){this.m_locString=i;if(j){this.m_attributes=j.split(h.LocalizationObjectToken.ATTRIBUTE_DELIM)}else{this.m_attributes=[]}if(!isNaN(k)){this.m_attributes.push((k==1)?h.LocalizationObjectToken.SINGULAR:h.LocalizationObjectToken.PLURAL)}if(this.m_locString&&this.m_locString.m_gender!==null&&this.m_locString.m_gender!==undefined){this.m_attributes.push(this.m_locString.m_gender)}};d.extend(h.LocalizationObjectToken,{ATTRIBUTE_DELIM:",",DEFAULT_GENDER:"masc",SINGULAR:"singular",GENDERS:{masc:0,fem:1,neuter:2},PLURAL:"plural",VALID_ATTRIBUTES:["plural","singular","count","indefinite","definite","masc","fem"],LOOKUP_ATTRIBUTES:[["indefinite","definite"],["singular","plural"]]});h.LocalizationObjectToken.prototype=new h.LocalizationToken();d.extend(h.LocalizationObjectToken.prototype,{constructor:h.LocalizationObjectToken,getString:function(){var l=[];for(var k=0;k<h.LocalizationObjectToken.LOOKUP_ATTRIBUTES.length;++k){var j=d.arrayIntersect(this.m_attributes,h.LocalizationObjectToken.LOOKUP_ATTRIBUTES[k]);if(j.length>0){if(j.length==1){l.push(j[0])}else{throw new Error("Token attributes lead to an ambiguous variant.")}}}return this.m_locString.getVariation(l.join("_"))},validateAttributes:function(i){var j=d.arrayDiff(i,h.LocalizationObjectToken.VALID_ATTRIBUTES);if(j.length){throw"Invalid token attributes: "+j.join(",")}}});h.LocalizationName=function(i,j){this.m_name=i;if(!j){j=h.LocalizationName.DEFAULT_GENDER}this.m_attributes=[j]};h.LocalizationName.DEFAULT_GENDER="masc";h.LocalizationName.prototype=new h.LocalizationToken();d.extend(h.LocalizationName.prototype,{constructor:h.LocalizationName,getString:function(){return this.m_name}});h.LocalizedString=function(i,k,j){this.attributes=[];this.m_original=i;this.m_variations=k;this.m_gender=j};d.extend(h.LocalizedString,{ORIGINAL:"original",PROPAGATED_ATTRIBUTES:["indefinite","definite","singular","plural"]});h.LocalizedString.prototype={setGender:function(i){this.m_gender=i},getGender:function(){return this.m_gender},getVariation:function(i){if(i==h.LocalizedString.ORIGINAL){return this.m_original}else{return this.m_variations[i]}},toString:function(n,t){var y=[];for(var r in this.m_variations){if(this.m_variations.hasOwnProperty(r)){y.push(r)}}if(y.length===0){y.push(h.LocalizedString.ORIGINAL)}var z,o={};var s,q,u,x,m,l;var p,j,k,v;for(var w in n){if(n[w] instanceof h.LocalizationToken){m=n[w];p=[];j=h.LocalizedString.PROPAGATED_ATTRIBUTES;l=0;for(s=0;s<y.length;++s){q=this.getVariation(y[s]);u=q.match(new RegExp("{"+w+"(?:,\\s*([a-z,]+))?}"));if(u&&u.length==2){l++;if(typeof(u[1])=="string"&&u[1]!==""){x=u[1].split(",");j=d.arrayIntersect(j,x);p.push(x)}}}if(l>0){if(p.length>0){m.addAttributes(j);k=m.filterIndexes(p);v=[];for(s=0;s<k.length;++s){v.push(y[k[s]])}y=v}o[w]=m.getString()}}else{o[w]=n[w].toString()}}if(y.length==1){z=this.getVariation(y[0]).replace(new RegExp("{([^},]+),\\s*[a-z,]+}","g"),"{$1}")}else{if(y.length>1){throw new Error("Ambiguous token specification for string, please provide more token attributes to narrow your selection.")}else{if(y.length<1){throw new Error("No matches found")}}}return t.replace(z,o)}};h.SubstituterSimple=function(){};h.SubstituterSimple.prototype={replace:function(k,j){for(var i in j){if(j.hasOwnProperty(i)){k=k.replace(new RegExp("{"+i+"}","g"),j[i])}}return k}};h.SubstituterContractions=function(){};h.SubstituterContractions.prototype=new h.SubstituterSimple();d.extend(h.SubstituterContractions.prototype,{replace:function(t,m){for(var v in m){if(m.hasOwnProperty(v)){var l=m[v];var n=this.getContractionPattern();var r=l.match(n);if(r){var s=r[1];var q=l.replace(new RegExp("^"+s+" "),"");s=s.toLowerCase();var p=this.getContractionMap();var o=p[s];for(var j in o){if(o.hasOwnProperty(j)){var k=p[s][j];var u=this.getContraction(k,q);var i;if(u.substr(-1,1)=="'"){i=" "+u+q}else{i=" "+u+" "+q}t=t.replace(new RegExp("^"+j+" {"+v+"}"),i);t=t.replace(new RegExp(" "+j+" {"+v+"}","g"),i)}}}t=t.replace(new RegExp("{"+v+"}","g"),l)}}return t},getContractionPattern:function(){var i=this.getContractionMap();var l="";for(var j in i){if(i.hasOwnProperty(j)){l+=j+"|"}}l=l.substr(0,l.length-1);var k=new RegExp("^("+l+") ","i");return k},getContraction:function(i,j){if(typeof(i)=="string"){return String(i)}else{return""}}});h.SubstituterEs=function(){};h.SubstituterEs.prototype=new h.SubstituterSimple();d.extend(h.SubstituterEs.prototype,{replace:function(m,k){for(var i in k){if(k.hasOwnProperty(i)){var j=k[i];if(j.indexOf("el ")===0){var l=j.substr(3);m=m.replace(new RegExp(" de {"+i+"}","g")," del "+l);m=m.replace(new RegExp(" a {"+i+"}","g")," al "+l)}m=m.replace(new RegExp("{"+i+"}","g"),j)}}return m}});h.SubstituterPt=function(){};h.SubstituterPt.prototype=new h.SubstituterContractions();h.SubstituterPt.contractionMap={o:{de:"do",em:"no",por:"pelo",a:"ao"},a:{de:"da",em:"na",por:"pela",a:"??"},os:{de:"dos",em:"nos",por:"pelos",a:"aos"},as:{de:"das",em:"nas",por:"pelas",a:"??s"}};d.extend(h.SubstituterPt.prototype,{getContractionMap:function(){return h.SubstituterPt.contractionMap}});h.SubstituterDe=function(){};h.SubstituterDe.prototype=new h.SubstituterContractions();h.SubstituterDe.contractionMap={der:{an:"am",bei:"beim","in":"im",von:"vom",zu:"zum"},die:{zu:"zur"},das:{an:"ans","in":"ins"}};d.extend(h.SubstituterDe.prototype,{getContractionMap:function(){return h.SubstituterDe.contractionMap}});h.SubstituterFr=function(){};h.SubstituterFr.prototype=new h.SubstituterContractions();h.SubstituterFr.VOWEL="vowel";h.SubstituterFr.CONSONANT="consonant";h.SubstituterFr.vowels={a:1,"??":1,"??":1,"??":1,"??":1,e:1,"??":1,"??":1,"??":1,"??":1,i:1,"??":1,"??":1,"??":1,"??":1,o:1,"??":1,"??":1,"??":1,"??":1,u:1,"??":1,"??":1,"??":1,"??":1};h.SubstituterFr.contractionMap={le:{de:"du","??":"au"},les:{de:"des","??":"aux"},un:{de:"d'un"},une:{de:"d'une"},des:{de:{vowel:"d'",consonant:"de"}}};d.extend(h.SubstituterFr.prototype,{getContractionMap:function(){return h.SubstituterFr.contractionMap},getContraction:function(j,k){if(typeof(j)=="string"){return String(j)}var i=k.match(new RegExp("\\S"));var l=i[0];if(h.SubstituterFr.vowels.hasOwnProperty(l)){return j[h.SubstituterFr.VOWEL]}else{return j[h.SubstituterFr.CONSONANT]}}});h.Collator=function(u){var s={};var w={"default":"_0123456789aAbBcCdDeEfFgGhHiIjJkKlLmMnNoOpPqQrRsStTuUvVwWxXyYzZ",en_UD:"zZyYxXwWuUtTsSrRqQpPoOnNmMlLkKjJiIhHgGfFeEdDcCbBaA98765432310_"};var n=w["default"];if(w.hasOwnProperty(u)){n=w[u]}var v=n.split("").sort().join("");var q=[];var k=[];var j=0;for(var p=0;p<n.length;p++){if(n.charAt(p)!=v.charAt(p)){k[n.charAt(p)]=v.charAt(p);j++}}function t(y){if(q&&q[y]){return q[y]}else{var r="";for(var x=0;x<=y.length;x++){var z=y.charAt(x);if(k[z]){r+=k[z]}else{r+=z}}if(q){q[y]=r}return r}}function m(){var i;if(navigator){if(navigator.language){i=navigator.language}else{if(navigator.browserLanguage){i=navigator.browserLanguage}else{if(navigator.systemLanguage){i=navigator.systemLanguage}else{if(navigator.userLanguage){i=navigator.userLanguage}}}}}if(i){i=i.replace("-","_")}return i}function l(i,r){return i.toString().localeCompare(r.toString())}function o(x,i){var r=t(x);var y=t(i);if(r<y){return -1}else{if(r==y){return 0}else{return 1}}}s.sort=function(i,r){if(m()!==i&&w.hasOwnProperty(i)){return r.sort(o)}return r.sort(l)};return s};h.Localizer=function(i,k){this.m_locale=i;this.m_langCode=this.m_locale.split(h.Localizer.LOCALE_DELIMITER)[0];this.m_raw=k;this.m_cached={};for(var j in this.m_raw){if(this.m_raw.hasOwnProperty(j)){this.m_cached[j]={}}}if(h.Localizer.substituterMap.hasOwnProperty(this.m_locale)){this.m_substituter=new h.Localizer.substituterMap[this.m_locale]()}else{if(h.Localizer.substituterMap.hasOwnProperty(this.m_langCode)){this.m_substituter=new h.Localizer.substituterMap[this.m_langCode]()}else{this.m_substituter=new h.SubstituterSimple()}}this.m_collator=new h.Collator(this.m_locale)};d.extend(h.Localizer,{MASC:"masc",FEM:"fem",IMAGE_PACKAGE:"LocalizedImages",LOCALE_DELIMITER:"_",DEFAULT_GENDER:"masc",substituterMap:{es:h.SubstituterEs,en_UD:h.SubstituterEnFlip,en_PI:h.SubstituterEnZy,fr:h.SubstituterFr,pt:h.SubstituterPt,de:h.SubstituterDe}});h.Localizer.prototype={merge:function(j){for(var i in j){if(j.hasOwnProperty(i)){this.m_raw[i]=j[i];this.m_cached[i]={}}}},t:function(i,j,k){return this.translate(i,j,k)},tk:function(j,k,i,l){return this.createToken(j,k,i,l)},tn:function(i,j){return this.createName(i,j)},createToken:function(j,k,i,l){if(!i){i=""}return new h.LocalizationObjectToken(this.getString(j,k),i,l)},createName:function(i,j){if(!j){j=h.Localizer.DEFAULT_GENDER}return new h.LocalizationName(i,j)},translate:function(j,k,l){if(!l){l={}}var i=this.getString(j,k);if(i===null){return"Cannot find string ["+k+"] in package ["+j+"]."}else{return i.toString(l,this.m_substituter)}},translateImagePath:function(j){var i=this.getString(h.Localizer.IMAGE_PACKAGE,j);if(i===null){return"Cannot find path "+j}else{return i.getVariation(h.LocalizedString.ORIGINAL)}},sort:function(i){return this.m_collator.sort(this.m_locale,i)},getString:function(i,j){if(!this.m_raw.hasOwnProperty(i)){return null}if(!this.m_cached[i].hasOwnProperty(j)){if(this.m_raw[i].hasOwnProperty(j)){this.m_cached[i][j]=new h.LocalizedString(this.m_raw[i][j].original,this.m_raw[i][j].variations,this.m_raw[i][j].gender)}else{return null}}return this.m_cached[i][j]}};h.Formatter=(function(){var u=[[1,"Second"],[60,"Minute"],[3600,"Hour"],[86400,"Day"],[604800,"Week"],[2592000,"Month"],[31536000,"Year"]];var q="{n}";var r="ZLocDateTimeFormats";var t="currency";var j="date";var n="number";var p="duriation";var k="time";var i="am";var s="pm";var m={en_US:"${n}",fr:"{n} ???",it:"??? {n}",de:"{n} ???",es:"{n} ???",pt_BR:"R$ {n}",zh_TW:"NTD {n}",zh_CN:"{n}???",id:"Rp {n}",tr:"{n} TL",ko:"???{n}",ms:"RM {n}",ja:"???{n}",th:"??? {n}"};var l={"{d}":"j","{dd}":"d","{m}":"n","{mm}":"m","{yyyy}":"Y"};var o={"{h}":"g","{hh}":"h","{mm}":"i","{ss}":"s","{H}":"G","{HH}":"H","{a}":"a","{aa}":"aa"};return{CURRENT_LOCALE:"current_locale",getFormat:function(w){var v=h.instance.getString(r,w);return v.getVariation(h.LocalizedString.ORIGINAL)},timeAgoInWords:function(A,B){if(B===undefined||B===null){B=Math.floor(new Date()/1000)}var x=0;var y=u.length;var z=B-A;while((x+1)<y&&u[x+1][0]<=z){x++}var w=Math.floor(z/u[x][0]);var v=u[x][1];if(x==1&&w==1){return h.t("Time","EstimateTimeAgoInWords",{timeUnit:h.tk("Time",v)})}else{return h.t("Time","TimeAgoInWords",{timeUnit:h.tk("Time",v,"",w),count:w})}},formatList:function(y,v){var z=h.t("Lists",v!==false?"and":"or");if(y.length<2){return y.join("")}else{if(y.length==2){return y.join(" "+z+" ")}else{var x=[y.pop(),z,y.pop()].reverse().join(" ");y.push(x);var w=h.t("Lists","delimiter")+" ";return y.join(w)}}},formatDate:function(x){var B=h.Formatter.getFormat(j);var A=B.match(new RegExp("{([^}]+)}","g"));var z;for(var v in A){if(A.hasOwnProperty(v)){var y=A[v];z=h.Formatter.getFormattedDateTime(l[y],x);var w=B.split(y);B=w.join(z)}}return B},formatTime:function(v,y){y=(y===undefined)?true:y;var B=h.Formatter.getFormat(k);if(!y){var D=B.replace(":{ss}","");if(D==B){B=B.replace(new RegExp("({ss}[^{]*)"),"")}else{B=D}}var A=B.match(new RegExp("{([^}]+)}","g"));var x;for(var z in A){if(A.hasOwnProperty(z)){var w=A[z];x=h.Formatter.getFormattedDateTime(o[w],v);var C=B.split(w);if(x=="pm"){x=h.Formatter.getFormat(s)}else{if(x=="am"){x=h.Formatter.getFormat(i)}}B=C.join(x)}}return B},formatDuration:function(D,y,z){y=(y===undefined)?true:y;z=(z===undefined)?true:z;var v=h.instance.m_langCode;var C=D%60;var w=Math.floor(D/60)%60;var A=Math.floor(D/3600);var x;var E;var B=h.Formatter.getFormat(p);if(!z){if("{h}:{mm}:{ss}"==B){B="{h}:{mm}"}else{B=B.replace(new RegExp("({ss}[^{]*)"),"")}}else{x=(C<10)?"0"+C:C.toString();E=B.split("{ss}");B=E.join(x)}if(!y&&A===0){B=B.replace(new RegExp("([^{]*{h}[^{]*)"),"");x=w.toString();E=B.split("{mm}");B=E.join(x)}else{x=(w<10)?"0"+w:w.toString();E=B.split("{mm}");B=E.join(x);x=A.toString();E=B.split("{h}");B=E.join(x)}return B},formatNumber:function(H){var G=h.Formatter.getFormat(n);var I=G.split("|");var v=I[0];var x=I[1];var F=H.toString().split(".");var y;var E;if(F.length>1){y=F[0];E=F[1]}else{x="";y=F[0];E=""}var C=y.length;var B=C%3;var w=y.substr(0,B);var z;if(!w.length){z=[]}else{z=new Array(w)}for(var A=B;A<C;A+=3){z.push(y.substr(A,3))}var D=z.join(v)+x+E;return D},formatCurrency:function(w,y){var z;if(y==h.Formatter.CURRENT_LOCALE){z=h.Formatter.getFormat(t)}else{if(!m.hasOwnProperty(y)){throw new Error("Locale: "+y+", is unsupported in currencyFormats")}else{z=m[y]}}var x=h.Formatter.formatNumber(w);var v=z.split(q);return v.join(x)},getMultiFormattedDateTime:function(y,x){var v=[];for(var w=0;w<y.length;w++){v[w]=h.Formatter.getFormattedDateTime(y[w],x)}return v},getFormattedDateTime:function(y,w){var v,x;switch(y){case"a":case"aa":var z=w.getHours()<12;if(z){v="am"}else{v="pm"}break;case"j":v=w.getDate().toString();break;case"d":v=w.getDate().toString();if(v.length==1){v="0"+v}break;case"n":v=(w.getMonth()+1).toString();break;case"m":v=(w.getMonth()+1).toString();if(v.length==1){v="0"+v}break;case"Y":v=w.getFullYear().toString();break;case"g":x=w.getHours()%12;if(x===0){x=12}v=x.toString();break;case"h":x=w.getHours()%12;if(x===0){x=12}v=x.toString();if(v.length==1){v="0"+v}break;case"i":v=w.getMinutes().toString();break;case"s":v=w.getSeconds().toString();break;case"G":v=w.getHours().toString();break;case"HH":v=w.getHours().toString();if(v.length==1){v="0"+v}break;default:break}return v}}}());h.init("fr_FR",{Inbox:{listNames:{original:"{commaDelimNames} et {finalName}"},followUpCTASendGiftBack:{original:"Renvoyer un cadeau"},followUpCTASendGift:{original:"Envoyer un cadeau"},followUpInviteTitle:{original:"{listNames} et vous \u00eates d\u00e9sormais voisins."},followUpInviteBody:{original:"Voulez-vous en profiter pour envoyer le cadeau suivant\u00a0: {gift}\u00a0?"},followUpGiftBody:{original:"Envoyer un cadeau de remerciement \u00e0 {listNames}\u00a0?"},followUpCrewBody:{original:"Envoyer 1 {gift} \u00e0 {listNames}\u00a0?"},formatCTAAccept:{original:"Accepter"},formatCTAAcceptAll:{original:"Tout accepter"},formatCTAAcceptSee:{original:"Accepter et afficher"},formatCTAAcceptSend:{original:"Accepter et envoyer"},formatCTAAcceptOnly:{original:"Accepter uniquement"},formatCTAHelp:{original:"Aide"},formatCTASendGiftBack:{original:"Renvoyer un cadeau"},formatCTASendGift:{original:"Envoyer un cadeau"},formatCTASendGifts:{original:"Envoyer des cadeaux"},formatGiftAggregateTitle:{original:"Vous avez re\u00e7u {number} {gift}."},formatGiftAggregateBody:{original:"Accepter le cadeau et en renvoyer un \u00e0 {listNames}\u00a0?"},formatGiftSingleTitle:{original:"{name1} vous a envoy\u00e9 : {gift}."},formatGiftSingleBody:{original:"Accepter le cadeau et en renvoyer un \u00e0 {name1}\u00a0?"},formatInviteAggregateTitle:{original:"Vous avez {number}\u00a0{neighbors,object,count}.",variations:["Vous avez {number}\u00a0{neighbors,fem,plural}.","Vous avez {number}\u00a0 {neighbors,fem,singular}.","Vous avez {number}\u00a0{neighbors,masc,plural}.","Vous avez {number}\u00a0{neighbors,masc,singular}."]},neighbors:{original:"une invitation de voisinage",variations:{indefinite_singular:"une invitation de voisinage",singular:"invitation de voisinage",plural:"invitations de voisinage",indefinite_plural:"des invitations de voisinage",definite_plural:"les invitations de voisinage",definite_singular:"l'invitation de voisinage"},gender:"fem"},formatInviteAggregateSubText:{original:"{listNames}"},formatInviteAggregateBody:{original:"Faites-lui savoir que vous avez accept\u00e9."},formatInviteSingleTitle:{original:"{name1} veut faire partie de vos voisins dans {game}."},formatInviteSingleBody:{original:"Accepter son invitation\u00a0?"},formatHelpAggregateTitle:{original:"Vos amis ont besoin de ceci\u00a0: {type}."},formatHelpAggregateBody:{original:"Faites-leur savoir que vous pouvez les aider."},formatHelpAggregateSubText:{original:"{listNames}"},formatHelpSingleTitle:{original:"{name1} a envoy\u00e9\u00a0:"},formatHelpSingleBody:{original:"Bonjour\u00a0! Pouvez-vous m'aider en m'envoyant 1 {type}\u00a0?"},formatCrewAggregateTitle:{original:"Vos amis ont besoin d'aide pour construire ceci\u00a0: {type}."},formatCrewAggregateBody:{original:"Faites-leur savoir que vous leur pr\u00eatez main forte."},formatCrewAggregateSubText:{original:"{listNames}"},formatCrewSingleTitle:{original:"{name1} a envoy\u00e9\u00a0:"},formatCrewSingleBody:{original:"J'ai besoin de vous au sein de l'\u00e9quipe {crew} dans ma ville."},formatNotifSingleTitle:{original:"{name1} vous a envoy\u00e9 un objet que vous aviez demand\u00e9."},formatNotifSingleBody:{original:"Envoyez-lui un cadeau en remerciement."},formatNotifAggregateTitle:{original:"Vos amis vous ont envoy\u00e9 des objets que vous aviez demand\u00e9s."},formatNotifAggregateBody:{original:"Envoyez-leur un cadeau en remerciement."},formatNotifAggregateSubText:{original:"{listNames}"},formatExpiredTitle:{original:"Les demandes de {number} {friends,object,count} ont expir\u00e9. Consultez cette page plus souvent\u00a0!",variations:["Les demandes de {number} {friends,fem,plural} ont expir\u00e9. Consultez cette page plus souvent\u00a0!","Les demandes de {number} {friends,fem,singular} ont expir\u00e9. Consultez cette page plus souvent\u00a0!","Les demandes de {number} {friends,masc,plural} ont expir\u00e9. Consultez cette page plus souvent\u00a0!","Les demandes de {number} {friends,masc,singular} ont expir\u00e9. Consultez cette page plus souvent\u00a0!"]},formatExpiredBody:{original:"Envoyer {gift} comme cadeau de remerciement \u00e0\u00a0: {listNames}"},groupGift:{original:"Cadeau"},groupGifts:{original:"Cadeaux"},groupInvite:{original:"Invitation de voisinage"},groupInvites:{original:"Invitations de voisinage"},groupHelp:{original:"Demande d'aide"},groupHelps:{original:"Demandes d'aide"},groupCrew:{original:"Invitation d'\u00e9quipe"},groupCrews:{original:"Invitations d'\u00e9quipe"},groupFactory:{original:"Invitation d'usine"},groupFactories:{original:"Invitations d'usine"},groupNotif:{original:"Notification"},groupNotifs:{original:"Notifications"},groupRecommendation:{original:"Voisin recommand\u00e9"},groupRecommendations:{original:"Voisins recommand\u00e9s"},groupExpired:{original:"Demande expir\u00e9e"},groupExpireds:{original:"Demande(s) expir\u00e9e(s)"},groupFeed:{original:"Demander"},groupFeeds:{original:"Demander"},feedPromptTitle:{original:"Vos amis vous aident \u00e0 agrandir votre ville."},feedPromptContent:{original:"Demandez des ZAC \u00e0 vos amis."},feedPromptCTA:{original:"Demander"},scrollhead:{original:"Bo\u00eete de r\u00e9ception"},sendGift:{original:"Envoyer un cadeau"},friends:{original:"un ami",variations:{indefinite_singular:"un ami",singular:"ami",plural:"amis",indefinite_plural:"des amis",definite_plural:"les amis",definite_singular:"l'ami"},gender:"masc"}}});(function(q,m,z,r){var l,n=(function(I){var H=typeof q!=="undefined"?q:global,L=Object.prototype.hasOwnProperty.call(H,I),K=H[I],J=H[I]={};if(typeof module!=="undefined"&&module.exports){module.exports=J}J.noConflict=function(){H[I]=L?K:l;if(!L){try{delete H[I]}catch(M){}}return this};return J}("Inbox1P"));n.VERSION="0.5.20";var k=n.atom=z.atom,G=n.clock=z.clock,C=n.style=z.style,t=n.validator=z.validator,u=n.UserInfo=z.UserInfo,w=z.callDAPI,B=n.defaultGift={id:"giftRequest",name:"coins",eventTypeId:14000},i=n.requestTypes={gift:14000,help:14002,invite:14001,notif:35008,other:13028},p=ZY.PrepareURL,F=n.a=k.create(),j=n.session=G.session(),y="//"+q.location.hostname+"/";var x=n.loc=function(H,I){return m.t("Inbox",H,I)};var s=n.locTk=function(I,H,J){return m.tk("Inbox",I,H,J)};F.set({acceptURL:y+"zsc/callback.php",giftBackInputsURL:y+"zsc/zsc_r2_giftBack_inputs.php",ignoreURL:y+"zsc/callback.php",messagesURL:y+"zsc/evt_data.php",feedGetURL:y+"zsc/zsc_feed_data.php",feedInputsURL:y+"zsc/zsc_feed_inputs.php",feedPostURL:y+"zsc/zsc_feed_post.php",assetURL:"//zynga1-a.akamaihd.net/zlive/channels/Inbox1P/"+n.VERSION+"/assets",pollMin:15000,pollMax:900000});z.once("prodGameID",function(H){F.set("gid",H)});var v=n.log=function(I,H){if(console&&console.log){if(typeof I==="string"){console.log((H?H+" ":"")+"Inbox1P: "+I)}else{console.log((H?H+" ":"")+"Inbox1P:");console.log(I)}}};var A=n.error=function(H){v(H,"ERROR:")};var E=n.info=function(H){v(H,"INFO:")};var D=n.warn=function(H){v(H,"WARN:")};var o=n.signURL=function(J,M){var L=r.each,H=J,K=[],I=p;if(M){if(typeof M==="string"){H=M}else{L(M,function(N,O){K.push(N+"="+O)});H=K.join("&")}H=J+(J.indexOf("?")===-1?"?":"&")+H}return(I!==l)?I(H):H}}(window,h,a,f));(function(n,v,o){var w=n.a,q=n.atom,u=o.each,k=w.get,x=w.set,m=n.log,t=n.session,p=n.signURL,l,l,s=n.UserInfo,j=n.users=q.create(),i=n.validator,r=n.warn;w.once(["gid","messagesURL"],function(B,F){var A=o.getJSON,C={};function E(G,H){var J=[],I=[],K=false;u(G,function(Q,L){K=true;if(L.metadata&&L.metadata.sender){L.metadata.sender+=""}if(!i.validate("GameMessage",L)){r("Game message validation failed: "+i.error);return}var N={},S=Q,O=L.metadata,M=O.sender+"",R=function(){var T=j.get(M);var U={id:Q,sender:{zid:T.zid,name:T.name,snid:T.snid,snuid:T.snuid,pic:T.pic},snid:T.snid,game:B,type:O.expired?"expired":O.type,agg:O.expired?"expired":(((O.preventAggregation&&O.type!=="gift")||N.waitForServer)?"":O.subtype),ts:O.timestamp,request_ids:{},data:N,loc:{}};if(U.agg==="expired"){U.batchSize=200}J.push(U)};if(O.subtype){N.subtype=O.subtype}if(O.subtype_aggregate){N.subtype_aggregate=O.subtype_aggregate}if(O.expired){N.expired=O.expired}if(O.type==="other"&&!O.expired&&O.type_text){N.type_text=O.type_text}if(O.waitForServer){N.waitForServer=O.waitForServer}if(O.contentID){N.contentID=O.contentID;if(!N.waitForServier&&N.contentID.indexOf("mysterygift")>-1){N.waitForServer=true}}if(O.giftBackAble){N.giftBackAble=O.giftBackAble}if(!O.expired&&L.data&&L.data[0]){var P=L.data[0];if(P.image){N.image=P.image}if(P.title){N.title=P.title}if(P.body){N.body=P.body}}if(!C[S]){if(j.has(M)){R()}else{I.push(M);j.once(M,R)}C[S]=true}});if(H&&!K){H(0)}s.get(I,18,function(L){var M=J.length||0;u(L,function(O,N){j.set(O,{zid:N.zid,name:N.name,snid:N.snid,snuid:N.snuid,pic:N.pic})});if(J.length){w.set("messagesProcessed",J);v.addRawMessages(J,function(){if(H){H(M)}})}else{if(H){H(0)}}})}function z(H,G){H=H||function(){};if(!G||(k("messagesFetched")!==true)){x("messagesFetched",true);A(p(F),function(I){E(I,function(J){v.InboxService.notifyFetchComplete();H()})})}else{H()}}var D=t.poller(function(){z(l,k("messagesFetched")!==true)},k("pollMin"),k("pollMax"));D.poll();n.poll=D.poll;function y(G){v.showSpinner();z(function(){v.hideSpinner();v.refreshMessages()},G)}v.once("open",function(){y(true);v.on("open",function(){y()})})})}(Inbox1P,a,f));(function(i,k){var m=i.loc,j=i.a,l={feed:0,recommendation:1,gift:2,help:3,other:4,notif:5,invite:6,expired:7};k.set({compareGroups:function(o,n){return l[o.messages[0].type]-l[n.messages[0].type]},compareMessages:function(o,n){return n.timestamps[0]-o.timestamps[0]},groupMessage:function(n){switch(n.type){case"feed":return{singular:m("groupFeed"),plural:m("groupFeeds")};case"gift":return{singular:m("groupGift"),plural:m("groupGifts")};case"invite":return{singular:m("groupInvite"),plural:m("groupInvites")};case"help":return{singular:m("groupHelp"),plural:m("groupHelps")};case"notif":return{singular:m("groupNotif"),plural:m("groupNotifs")};case"other":return{singular:n.data.type_text,plural:n.data.type_text};case"recommendation":return{singular:m("groupRecommendation"),plural:m("groupRecommendations")};case"expired":return{singular:m("groupExpired"),plural:m("groupExpireds")};default:return{singular:n.type,plural:n.type}}}})}(Inbox1P,a));(function(i,m){var n=true,k=i.defaultGift,p="CastleVille",o=i.loc,j=i.locTk;var l=i.listNames=function(s){if(s.length<2){return s.length===1?s[0].name:""}var r=0,q=s.length-1,t=[];for(;r<q;r+=1){t.push(s[r].name)}return o("listNames",{commaDelimNames:t.join(", "),finalName:s[q].name})};i.a.set("gameName",p);m.set({gameName:p,formatMessage:function(x){var w={ids:x.ids,senders:x.senders,type:x.type,timestamps:x.timestamps,primaryCTA:{key:"accept",text:o("formatCTAAccept")},giftBackTracking:"ref=pbChainv2"},v=x.data,s=v.subtype,t=v.waitForServer,r=v.subtype_aggregate||s,u=x.senders[0].name,q=x.ids.length;switch(x.type){case"gift":if(q>1){w.title=o("formatGiftAggregateTitle",{number:q,gift:r});w.body=o("formatGiftAggregateBody",{listNames:l(x.senders)});w.primaryCTA={key:"accept",text:o("formatCTAAcceptAll")}}else{w.title=v.title?v.title+" ":"";w.title+=o("formatGiftSingleTitle",{name1:u,gift:v.subtype});w.body=o("formatGiftSingleBody",{name1:u});if(t){w.secondaryCTA={key:"accept_see",text:o("formatCTAAcceptSee")}}}if(!t&&n){w.primaryCTA={key:"accept_send",text:o("formatCTAAcceptSend")};w.secondaryCTA={key:"accept_only",text:o("formatCTAAcceptOnly")}}delete w.giftBackTracking;break;case"invite":if(q>1){w.title=o("formatInviteAggregateTitle",{number:q,neighbors:j("neighbors","",q)});w.subtext=o("formatInviteAggregateSubText",{listNames:l(x.senders)});w.body=o("formatInviteAggregateBody");w.primaryCTA={key:"accept",text:o("formatCTAAcceptAll")}}else{w.title=o("formatInviteSingleTitle",{name1:u,game:p});w.body=o("formatInviteSingleBody");w.primaryCTA={key:"accept",text:o("formatCTAAccept")}}break;case"help":if(q>1){w.title=o("formatHelpAggregateTitle",{number:q,type:r});w.body=o("formatHelpAggregateBody");w.subtext=o("formatHelpAggregateSubText",{listNames:l(x.senders)});w.primaryCTA={key:"accept",text:o("formatCTAAcceptAll")}}else{w.title=v.title||o("formatHelpSingleTitle",{name1:u});w.body=v.body||o("formatHelpSingleBody",{type:x.data.subtype+""});w.primaryCTA={key:"accept",text:o("formatCTAAccept")}}break;case"crew":case"factory":case"other":if(q>1){w.title=o("formatCrewAggregateTitle",{number:q,type:r});w.body=o("formatCrewAggregateBody");w.subtext=o("formatCrewAggregateSubText",{listNames:l(x.senders)});w.primaryCTA={key:"accept",text:o("formatCTAAcceptAll")}}else{w.title=o("formatCrewSingleTitle",{name1:u});w.body=o("formatCrewSingleBody",{crew:x.data.subtype+""});w.primaryCTA={key:"accept",text:o("formatCTAAccept")}}break;case"notif":if(q>1){w.title=o("formatNotifAggregateTitle",{number:q,type:r});w.body=o("formatNotifAggregateBody");w.subtext=o("formatNotifAggregateSubText",{listNames:l(x.senders)});w.primaryCTA={key:"accept_send",text:o("formatCTASendGifts")}}else{w.title=v.title||o("formatNotifSingleTitle",{name1:u});w.body=o("formatNotifSingleBody");w.primaryCTA={key:"accept_send",text:o("formatCTASendGiftBack")}}break;case"recommendation":break;case"expired":q=x.senders.length;w.title=o("formatExpiredTitle",{number:q,friends:j("friends","",q)});w.body=o("formatExpiredBody",{gift:k.name,listNames:l(x.senders)});w.primaryCTA={key:"send",text:o("formatCTASendGiftBack")};w.image="//zynga1-a.akamaihd.net/zlive/snapi_plugins/r21501-prod/plugins/inbox/img/expired.png";w.giftBackTracking="ref=expired";break;case"feed":w.title=v.title;w.body=v.body;w.primaryCTA=v.primaryCTA;w.image=v.image;break;default:w.title="Unknown message type.";w.body="Sorry, I do not know how to categorize a message event of type: "+x.type;break}if(n&&!t){switch(x.type){case"gift":case"invite":case"help":case"crew":case"factory":case"other":w.primaryCTA={key:"accept_send",text:o("formatCTAAcceptSend")};w.secondaryCTA={key:"accept_only",text:o("formatCTAAcceptOnly")}}}if(!x.expired&&s){w.subtype=s}if(v.image){w.image=v.image}if(v.contentID){w.contentID=v.contentID}return w}})}(Inbox1P,a));(function(m,p,s,n){var i=m.defaultGift,q=n.extend,l=m.listNames,o=m.loc,r=m.requestTypes;function j(u,v){m.acceptRequest({typeId:r[u.type],eventIds:u.ids,acceptOnly:!!u.acceptOnly},function(x){function z(A){return A&&A.success===false&&!A.hasOwnProperty("failureType")}if(!x||x.timeout||(u.type==="gift"&&(z(x)||(x.length&&z(x[0]))))){v({failure:{timeout:x.timeout}})}else{var y=x[0]?x[0]:x,w={totalGifts:y.totalGifts,limitGifts:y.limitGifts,expiredGifts:y.expiredGifts,otherGifts:y.otherGifts,acceptedGifts:y.totalGifts-(y.limitGifts+y.expiredGifts+y.otherGifts)};t(x);if(y.notif_data){m.sendNotifs(u.senders,y.notif_data,i.id,s.get("gid"))}if(y.contentID){w.contentID=y.contentID}if(y.message){w.message=y.message}if(y.giftBack){w.giftBack=y.giftBack}v(w)}})}function k(u,v){m.getGiftBackInputs(u.contentID,u.senders,u.giftBackTracking,function(w){if(w.status==="success"){var x=w.eligible,y={contentID:i.id,subtype:i.name,eventTypeId:i.eventTypeId};q(y,w.giftBack);if(x&&x.snuids&&x.snuids.length>0){m.sendGift({body:y.body||o("sendGift"),contentID:y.contentID,eligible:w.eligible.zids,gameId:s.get("gid"),button_href:y.button_post,postBackURL:y.postBackURL,sendkey:y.sendkey,timestamp:y.timestamp,title:y.title||o("sendGift"),type:"gift",type_id:r.gift,signature:y.signature},function(z){switch(z.status){case"cancel":case"failure":break;case"success":break}if(u.type==="expired"){m.ignoreRequests(u.ids)}v(z)})}else{v({status:"success"})}}else{v({status:"failure"})}})}function t(v){function u(z){if(!z.hasOwnProperty("failureType")){var y=z.clientNotification;if(y&&p[y]){y=p[y];if(typeof y==="function"){try{y(z)}catch(x){}}}}}if(v.length){for(var w=0;w<v.length;w+=1){u(v[w])}}else{u(v)}}s.set("followUp",function(w,x,y){var u={ids:w.ids,senders:w.senders,type:w.type,timestamps:w.timestamps};if(w.hasOwnProperty("image")){u.image=w.image}if(w.hasOwnProperty("contentID")){u.contentID=w.contentID}if(w.hasOwnProperty("notifData")){u.notifData=w.notifData}if(w.hasOwnProperty("giftBackTracking")){u.giftBackTracking=w.giftBackTracking}if(w.hasOwnProperty("giftBack")){u.giftBack=w.giftBack}if(w.hasOwnProperty("giftBackAble")){u.giftBackAble=w.giftBackAble}function v(z){if(!z){return}if(z.failure){s.set("accept-failure",{action:x,message:w,failure:z.failure})}if(z.sendResponse){s.set("send-complete",{action:x,message:w,sendResponse:z.sendResponse})}if(z.totalGifts){s.set("accept-status",{message:w,action:x,status:{totalGifts:z.totalGifts,limitGifts:z.limitGifts,expiredGifts:z.expiredGifts,otherGifts:z.otherGifts,acceptedGifts:z.acceptedGifts}})}}switch(x){case"accept":case"accept_only":if(x==="accept_only"){w.acceptOnly=true}j(w,v);u.primaryCTA={key:"send",text:o("followUpCTASendGift")};if(w.type==="gift"){u.contentID=w.contentID;u.body=o("followUpGiftBody",{listNames:l(w.senders)});u.primaryCTA={key:"send",text:o("followUpCTASendGiftBack")}}else{u.contentID=i.id;u.body=o("followUpCrewBody",{gift:i.name,listNames:l(w.senders)});if(w.type==="invite"){u.title=o("followUpInviteTitle",{listNames:l(w.senders)});u.body=o("followUpInviteBody",{gift:i.name});u.primaryCTA={key:"send",text:o("followUpCTASendGift")}}}y(u);break;case"accept_send":j(w,function(z){v(z);var A=false;if(u.hasOwnProperty("giftBack")||u.hasOwnProperty("giftBackAble")){u.contentID=u.giftBack.contentID||z.contentID||u.contentID||i.id;A=true}else{if(z.hasOwnProperty("giftBack")||z.hasOwnProperty("giftBackAble")){u.contentID=z.giftBack.contentID;A=true}}if(A){k(u,function(B){v({sendResponse:B})})}});y();break;case"accept_see":j(w,function(z){v(z);if(!z||!z.message){y();return}q(u,z);u.body=z.message;u.primaryCTA={key:"send",text:o("followUpCTASendGiftBack")};y(u)});break;case"send":if(!u.contentID){u.contentID=i.id}k(u,function(z){v({sendResponse:z})});y();break;case"accept_feed":m.postFeed(w.ids[0],w.endpoint,w.feed_type);y();break;default:y();break}})}(Inbox1P,window,a,f));(function(i,q,j){var r=i.a,o=i.error,m=j.getJSON,t=q.InboxService,p=i.requestTypes,n=i.session,k=i.signURL;function s(v){var u=t.getRawMessage(v);if(!u){o("getRemoveRequestType(): Cannot find type for eventID: "+v);return 0}return p[u.type]}function l(v,u,w){r.once("ignoreURL",function(x){var y=false,z=10000+(v.length*1000),A=v[0];n.setTimeout(function(){if(!y){w({status:"failure",timeout:true});y=true}},z);m(k(x,{action:"ignore",eventId:A,eventTypeId:s(A),zy_ctoken:""}),{all:"all",eventIds:v},function(B){if(!y){if(w){w({status:(B&&B.success===false)?"failure":"success"})}y=true}})})}i.ignoreRequests=function(u){t.deleteMessages(u);l(u)};t.on("messagesIgnored",function(u){l(u)});i.acceptRequest=function(u,v){r.once("acceptURL",function(y){var w=false,x=10000+(u.eventIds.length*1000);n.setTimeout(function(){if(!w){v({status:"failure",timeout:true});w=true}},x);m(k(y,{action:"accept",eventId:u.eventIds[0],eventTypeId:u.typeId,zy_ctoken:""}),{all:"all",eventIds:u.eventIds,acceptOnly:u.acceptOnly},function(z){if(!w){v(z);w=true}})})}}(Inbox1P,a,f));(function(j,n,t,k){var u=j.a,m=t.atom,w=t.callDAPI,s=k.each,q=k.extend,r=j.session,l=j.signURL,x={Facebook:1,Zynga:18},p=t.UserInfo,o=j.warn;function v(B,C){var z=0,y=B.length,A=[];for(;z<y;z+=1){A.push(B[z][C])}return A}function i(z,A){var y={gameId:z.gameId,toZid:z.eligible,type:z.type,data:{title:z.title||"Send Request",body:z.body||"Send Request"},eventTypeId:z.type_id};q(y.data,z.data);if(z.button_href){y.data.button_href=z.button_href}n.api("request.send",y,A,true)}j.getGiftBackInputs=function(A,y,z,B){u.once("giftBackInputsURL",function(C){k.post(l(C,z),{gift:A,zids:v(y,"zid")},function(E){if(!E){o("GiftBackInputs retrieval failed");B({status:"failure"});return}var D=m.create();D.once(["eligible_userInfos","ineligible_userInfos"],function(H,G){B({status:"success",eligible:{snuids:v(H,"snuid"),zids:v(H,"zid")},ineligible:{snuids:v(G,"snuid"),zids:v(G,"zid")},giftBack:{button_post:E.acceptUrlR2,image:E.giftImageURL,sendkey:E.outgoingSendKey,title:E.title,body:E.body,contentID:E.giftbackName,name:E.giftbackName,subtype:E.giftbackFriendlyName,subtypeAggregate:E.giftbackFriendlyName,button_text:E.buttonText,signature:E.signature,timestamp:E.timestamp,postBackURL:E.sendPostBack,giftCode:E.giftCode,gameData:E.gameData,eventTypeId:E.giftbackEventTypeId},postBackURL:E.sendPostBack})});function F(G,I){var H=[];if(!G||G.length<1){D.set(I,H);return}p.get(G,x.Zynga,function(K,J){s(J,function(L,M){H.push(K[M])});D.set(I,H)})}F(E.eligible,"eligible_userInfos");F(E.inEligible,"ineligible_userInfos")})})};j.sendGift=function(B,C){var y,z=false,A=20000;r.setTimeout(function(){if(!z){C({status:"failure",timeout:true});z=true}},A);B.data={data:{item:B.contentID,reverse:"",ts:B.timestamp,signature:B.signature}};i(B,function(D){if(!D){k.get(l(B.postBackURL,"error=null"));y={status:"cancel"}}else{if(typeof D==="string"){k.get(l(B.postBackURL,"error="+D));y={status:"failure"}}else{k.post(l(B.postBackURL),{action:"send",gift:B.contentID,key:B.sendkey,zids:B.eligible,postedIDs:D});y={status:"success"}}}if(!z){C(y);z=true}})};j.sendNotifs=function(A,C,D,z){var y=v(A,"zid"),B={gameId:z,eligible:y,type:"notif",type_id:C.eventTypeId,contentID:D,giftBackTracking:"ref=notif",data:{}};q(true,B.data,C);i(B,function(E){s(y,function(G,F){w("ztrack.messageSendkeyTo",{sendKey:C.data.sendkey,toZid:F,status:"ok"})})})}}(Inbox1P,c,a,f));(function(){var l=(function(o){var n=typeof window!=="undefined"?window:global,r=Object.prototype.hasOwnProperty.call(n,o),q=n[o],p=n[o]={};if(typeof module!=="undefined"&&module.exports){module.exports=p}p.noConflict=function(){n[o]=r?q:undefined;if(!r){try{delete n[o]}catch(s){}}return this};return p}("linger"));l.VERSION="0.0.5";var k=window.localStorage,i="*",m=":";l.ERRORS={NOT_SUPPORTED:1,QUOTA_EXCEEDED:2};l.cache=function(o){var q=(o&&typeof o==="string")?o:i,r=function(s){s=p.namespace+m+s;return p.serializer.serialize(s)},n=function(s){s=s.slice(p.namespace.length+m.length);return p.serializer.deserialize(s)},p={namespace:q,serializer:{serialize:function(s){return s},deserialize:function(s){return s}},get:function(s,u){s=r(s);var t=p.serializer.deserialize(k.getItem(s));u(null,t)},set:function(s,v,w){var t;s=r(s);try{t=k.setItem(s,p.serializer.serialize(v));w(null,t)}catch(u){if(u.code&&(u.code===22||u.code===1024)){w({err:l.ERRORS.QUOTA_EXCEEDED,msg:"Quota Exceeded!"},null)}else{throw u}}},remove:function(s,u){s=r(s);var t=k.removeItem(s);if(u){u(null,t)}},length:function(s){p.keys(function(u,t){s(u,t&&t.length)})},keys:function(x){var w=[],u,s=k.length,v=p.namespace+m,t=0;while(t<s){u=k.key(t);if(u.indexOf(v)===0){w.push(n(u))}t++}x(null,w)},clear:function(s){p.keys(function(u,t){function v(){var w=t.shift();if(w){p.remove(w,v)}else{if(s){s()}}}v()})}};return p};var j=l.cache(i);l.serializer=j.serializer;l.get=j.get;l.set=j.set;l.remove=j.remove;l.length=j.length;l.keys=j.keys;l.clear=j.clear}());(function(l,q,t,x,m){var r,E=l.a,s=l.loc,i=l.session,w="lastPost",n="lastView",o=q.cache("feedPrompts"),v=[],u,k,p=60,B=4*p;function D(G){var F=r.feed.strings;if(F&&F.hasOwnProperty(G)){return F[G]}else{throw"String not found for key: "+G}}function A(G,H,I){var F=l.signURL(G+"?callback=?");m.getJSON(F,H,I)}function z(H,I,F){var G=l.signURL(H);m.post(l.signURL(H),I,F)}function y(G){var F={kingdom:"feed",phylum:r.feed.feedType,"class":r.gameName};m.extend(F,G);x.trackCount(F)}function C(){if(!E.has("feedItems")){E.set("feedItems",[])}var H=[];function F(I){return{pic:I,zid:20000000000,snid:18,snuid:"1",name:"none"}}function G(P,N,I,K,O,M,L,J){return{id:P,sender:F(I),snid:18,game:E.get("gid"),type:"feed",agg:"",ts:N,data:{title:O,body:M,image:K,primaryCTA:{key:"accept_feed",text:L}},request_ids:{},feed_type:J}}m.getJSON(l.signURL(E.get("feedGetURL")),function(I){var K=I;var N=new Date();v=E.get("feedItems");if(K){for(var J=0;J<K.length;++J){var L=K[J];var M="feed"+J;H.push(G(M,N.getTime(),L.avatarPicUrl,L.itemPicUrl,L.title,L.content,L.cta,L.feedType));v[M]=L}}if(H.length>0){y({genus:"view"});E.set("feedsProcessed",H)}else{x.set("feedsFetched",0)}})}function j(){if(g_zscFeedsEnabled){o.get(n,function(G,F){F=parseInt(F,10)||0;if(!F||F<(new Date()-g_zscFeedsViewCooldown*60*1000)){x.set("showFeedPrompt",true);E.set("showFeedPrompt",true);o.set(n,(new Date()).getTime(),function(){})}else{x.set("showFeedPrompt",false)}})}else{x.set("showFeedPrompt",false)}}E.once(["feedConf","gid"],function(G,F){j();r=G;E.once("showFeedPrompt",function(){if(r.usePlainJson){u=z}else{u=A}var H=r.feed.cooldown!==k?r.feed.cooldown:B;o.get(w,function(J,I){I=parseInt(I,10)||0;if(!I||I<(new Date()-H*60*1000)){C()}else{x.set("feedsFetched",0)}})});l.info("feedPrompts: All globals loaded")});E.on("feedsProcessed",function(F){var G=F.length;x.addRawMessages(F,function(){x.set("feedsFetched",G)})});l.postFeed=function(J){function G(M,L){l.error("postFeed failure");y({genus:"error",milestone:M});if(r.feed.error){r.feed.error(L)}}function I(M,L){l.info("postFeed success");y({genus:"success",milestone:"stream.publish"});if(r.feed.success){r.feed.success(M,L)}document.getElementById("flashapp").externalAddSentFeed(L.viralName,L.vid);m.getJSON(l.signURL(E.get("feedPostURL")),{viralName:L.viralName,vid:L.vid,sendKey:L.sendKey},function(N){})}function K(L){if(!L){l.error("feed inputs api error");return}var M=L,N=false;l.info(L);M.auto_publish=true;t.api("stream.publish",{payload:M},function(O){if(N){return}N=true;if(!O||O.hasOwnProperty("error")||O.hasOwnProperty("error_code")){M.auto_publish=false;t.api("stream.publish",{payload:M},function(P){if(P){if(P.hasOwnProperty("error_code")){G("stream.publish error_code="+P.error_code,P)}else{if(P.hasOwnProperty("error")){G("stream.publish error="+P.error,P)}else{I(P,L)}}}else{G("stream.publish empty response",P)}})}else{I(O,L)}})}y({genus:"click"});var H;E.get("feedItems",function(L){H=L[J]});if(!H){l.error("missing feed: "+J);return}var F=E.get("feedInputsURL");u(F,{type:H.feedType},K);o.set(w,(new Date()).getTime(),function(){})}}(Inbox1P,linger,c,a,f));(function(i){var j=i.a;j.once(["assetURL","gameName"],function(k,l){j.set("feedConf",{gameName:l,usePlainJson:true,feed:{feedType:"permits_request",avatarPicUrl:k+"/expansion.png",itemPicUrl:k+"/permit.png",strings:{title:"feedPromptTitle",content:"feedPromptContent",cta:"feedPromptCTA"},success:function(n,m){},error:function(m){},cooldown:0}})})}(Inbox1P));linger.noConflict()})});