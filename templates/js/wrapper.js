if(typeof window.SNAPI=="undefined")throw"Attempted to import SNAPI.Wrappers without SNAPI already defined";if(typeof SNAPI.Wrappers=="undefined")throw"Attempted to import SNAPI.Wrappers.Facebook without SNAPI.Client already defined";if(typeof SNAPI.Wrappers.Facebook!="undefined")throw"Attempting to import SNAPI.Wrappers.Facebook twice";SNAPI.Wrappers.Facebook={},function(a){function o(a,b){for(var c=0;c<b.length;c++)if(a==b[c])return!0;return!1}function n(a){var b={zid:a.zid,first_name:a.hasOwnProperty("firstName")?a.firstName:"",last_name:a.hasOwnProperty("lastName")?a.lastName:"",name:a.hasOwnProperty("name")?a.name:"",pic:a.hasOwnProperty("pic")?a.pic:"",pic_square:a.hasOwnProperty("picSquare")?a.picSquare:"",pic_normal:a.hasOwnProperty("picNormal")?a.picNormal:"",pic_big:a.hasOwnProperty("picBig")?a.picBig:"",pic_small:a.hasOwnProperty("picSmall")?a.picSmall:"",sex:a.sex,birthday_date:a.hasOwnProperty("birthdayDate")?a.birthdayDate:0,last_login:a.hasOwnProperty("lastLogin")?a.lastLogin:0,email:a.hasOwnProperty("email")?a.email:"",locale:a.hasOwnProperty("locale")?a.locale:0,is_app_user:a.hasOwnProperty("isAppUser")?a.isAppUser:!1};b.name===""&&(b.name=b.first_name===""?b.last_name:b.first_name+" "+b.last_name);return b}function m(a,b){a.sex!==undefined&&(a.gender=a.sex),a.uid!==undefined&&(a.id=a.uid),a.birthday!==undefined&&(a.birthday_date=a.birthday);var c={zid:b,first_name:a.first_name,last_name:a.last_name,name:a.name,email:a.email||"",sex:a.gender?a.gender.charAt(0).toUpperCase():"",birthday_date:a.birthday_date||0,pic:"//graph.facebook.com/"+a.id+"/picture",pic_square:"//graph.facebook.com/"+a.id+"/picture?type=square",pic_normal:"//graph.facebook.com/"+a.id+"/picture?type=normal",pic_big:"//graph.facebook.com/"+a.id+"/picture?type=large",pic_small:"//graph.facebook.com/"+a.id+"/picture?type=small",last_login:0,is_app_user:a.is_app_user||!1,locale:a.locale,allowed_restrictions:a.allowed_restrictions?a.allowed_restrictions:""};return c}function l(a){return function(b,c){var d={data:SNAPI.JSON.stringify(b),method:a,success:c,error:function(b,d,e){var f=a+": "+d;SNAPI.Logger.error(f),c(f)}};SNAPI.Wrappers.Facebook.handleAjax(d)}}var b=!1,c=0,d=SNAPI.ZLoc,e=[],f=!1,g=document.createElement("div");g.id="fb-root",document.body.appendChild(g);var h=function(){f=!0;for(var a=0;a<e.length;a++)e[a]()},i="//connect.facebook.net/en_US/all.js";SNAPI.allGetter(SNAPI.FACEBOOK,"isBeta")&&(i="//connect.beta.facebook.net/en_US/all.js"),SNAPI.imports(i,h);var j,k=SNAPI.getConfig(SNAPI.getSNID());k.session&&k.session.user_id&&(j=k.session.user_id,SNAPI.addIdMapping(SNAPI.getCurrentUserId(),j,SNAPI.FACEBOOK)),SNAPI.Wrappers.Facebook.onClientLoad=function(a){f?a():e.push(a)},SNAPI.Wrappers.Facebook.getNativeInterface=function(){return FB},SNAPI.Wrappers.Facebook.getCanvasWidth=function(){return 760},SNAPI.Wrappers.Facebook.getCurrentUserId=function(){return SNAPI.getCurrentUserId()},SNAPI.Wrappers.Facebook.handleLinkClicked=function(a){return!0},SNAPI.Wrappers.Facebook.handleFormSubmitted=function(a){return!0},SNAPI.Wrappers.Facebook.handleAjax=function(a){var b=function(b){var c=a.success||function(){};b.hasOwnProperty("body")?c(b.body):(c=a.error||c,c("AJAX error."))},c=SNAPI.getAuthHash(),d=SNAPI.getCurrentUser(),e=SNAPI.getProxy(),f=SNAPI.getAppId(),g={type:"POST",url:e,data:{js:1,method:a.method,params:a.data,cmd_id:(new Date).getTime(),app_id:f,authHash:c,zid:d,snid:a.snId||SNAPI.getSNID()},success:b,dataType:"json"};a.hasOwnProperty("error")&&(g.error=a.error),SNAPI.jQuery.ajax(g)},SNAPI.Wrappers.Facebook.urlToCanvasUrl=function(a){typeof a=="undefined"&&(a="");var b=SNAPI.getCanvasUrl();a.indexOf(b)===0&&(a=a.substr(b.length));return b.charAt(b.length-1)==="/"?b+a:b+"/"+a},SNAPI.Wrappers.Facebook.urlFromCanvasUrl=function(a){return a},SNAPI.Wrappers.Facebook.wrapSNMLLinks=function(a){if(!a)return a;var b=SNAPI.getCallbackUrl(),c=SNAPI.getCanvasUrl();a=a.replace(/<snml:callback-url>(.*)<\/snml:callback-url>/g,function(){return b.charAt(b.length-1)==="/"?b+arguments[1]:b+"/"+arguments[1]}),a=a.replace(/<snml:canvas-url>(.*)<\/snml:canvas-url>/g,function(){return c.charAt(c.length-1)==="/"?c+arguments[1]:c+"/"+arguments[1]});return a},SNAPI.Wrappers.Facebook.ui={setResizeEnabled:function(b,c){var d=Math.max(a(document).height(),a(window).height(),a("body").innerHeight(),a("body").outerHeight()),e={width:SNAPI.getCanvasWidth(),height:d};try{FB.Canvas.setAutoGrow(b),FB.Canvas.setSize(e)}catch(f){SNAPI.Logger.error(f),c&&c(!1)}c&&c(!0)},setSize:function(a,b){try{FB.Canvas.setSize(a)}catch(c){b&&b(!1)}b&&b(!0)},showPermissionDialog:function(a,b){try{a.perms&&(a.scope=a.perms,delete a.perms),FB.login(function(a){b&&b(a.authResponse!==undefined)},a)}catch(c){b&&b(!1)}},showBookmarkDialog:function(a,b){try{FB.ui({method:"bookmark.add"})}catch(c){b&&b(!1)}b&&b(!0)},showFriendingDialog:function(a,b){b&&b([0,0,0])},showProfileDialog:function(a,b){b&&b(!1)},requireSession:function(a,c){function e(){b||(b=!0,FB.Event.subscribe("auth.authResponseChange",function(a){if(a.status=="connected"&&a.authResponse){var b={access_token:a.authResponse.accessToken,user_id:a.authResponse.userID};SNAPI.Wrappers.Facebook.updateSession(b,function(a){var c=SNAPI.getConfig(SNAPI.FACEBOOK);c.session=b,SNAPI.setConfig(SNAPI.FACEBOOK,c),SNAPI.setAuthHash(a.authHash),DAPI.setSessionKey(b)})}}))}var d=!1;try{FB.getLoginStatus(function(b){b.authResponse?(e(),c&&!d&&(d=!0,c(!0))):FB.login(function(a){a.authResponse?(e(),c&&!d&&(d=!0,c(!0))):c&&!d&&(d=!0,c(!1))},a)})}catch(f){c&&!d&&(d=!0,c(!1))}}},SNAPI.Wrappers.Facebook.api=function(){FB.api.apply(FB.api,arguments)},SNAPI.Wrappers.Facebook.api["auth.verifySession"]=function(a,b){FB.getLoginStatus(function(a){b(a!==undefined&&a.authResponse!==undefined)})},SNAPI.Wrappers.Facebook.api["dashboard.setCount"]=function(a,b){var c=a.zid||SNAPI.getCurrentUserId();SNAPI.getSNUIDs([c],SNAPI.FACEBOOK,function(d){var e={method:"dashboard.setCount",count:a.count,uid:d[c]};FB.api(e,b)})},SNAPI.Wrappers.Facebook.api["users.getPermissions"]=function(a,b){var c=a.perms;c===undefined?c=["publish_stream","status_update","photo_upload","sms"]:typeof c!="object"&&(c=[c]),FB.api("/fql","get",{q:"SELECT "+c.join()+" FROM permissions WHERE uid IN ("+j+")"},function(a){var c={};c[SNAPI.getCurrentUserId()]=a.data[0],b(c)})},SNAPI.Wrappers.Facebook.api["users.hasAppPermission"]=function(a,b){SNAPI.Wrappers.Facebook.api["users.getPermissions"](a,function(c){var d=a.user||SNAPI.getCurrentUserId(),e=c[d].perms;for(var f in e)if(e.hasOwnProperty(f)&&e[f]!=="1"){b(!1);return}b(!0)})},SNAPI.Wrappers.Facebook.api["users.getInfo"]=function(a,b){a===undefined||a===null||typeof a=="object"&&!a.length?FB.api("/me",function(a){var c=m(a,SNAPI.getCurrentUserId()),d={};d[SNAPI.getCurrentUserId()]=c,b&&b(d)}):(typeof a!="object"&&(a=[a]),SNAPI.getSNUIDs(a,SNAPI.FACEBOOK,function(a){var c=[];for(var d in a)a.hasOwnProperty(d)&&c.push(a[d]);if(c.length===0)b&&b({});else{var e={},f=c,g=function(){c=f,c.length>100?(f=c.slice(100),c=c.slice(0,100)):f=null,FB.api("/?ids="+c.join(),function(c){for(var d in a)if(a.hasOwnProperty(d)){if(c[a[d]]===undefined)break;e[d]=m(c[a[d]],d),delete a[d]}f===null?b&&b(e):g()})};g()}}))},SNAPI.Wrappers.Facebook.api["users.getEmail"]=function(a,b){FB.api("/me",function(a){a.error_code?b("",a.error_msg):b(a.email||null)})},SNAPI.Wrappers.Facebook.api["users.isAppUser"]=function(a,b){FB.api("/fql","get",{q:"SELECT is_app_user FROM user WHERE uid IN ("+j+")"},function(a){var c={};b(a.data[0].is_app_user)})},SNAPI.Wrappers.Facebook.api["friends.getZyngaNeighbors"]=function(a,b){DAPI.api.send({method:"friends.get",payload:{snid:SNAPI.ZGN,withInfo:a.info},callback:function(c){if(a.info){var d={};for(var e=0;e<c.length;e++)d[c[e].zid]=n(c[e]);b(d)}else b(c)}})},SNAPI.Wrappers.Facebook.api["friends.getFacebookNeighbors"]=function(a,b){var c=SNAPI.getCurrentUserId();if(a.info){var d="SELECT uid,first_name,last_name,name,email,sex,birthday_date,is_app_user,locale, allowed_restrictions FROM user WHERE uid IN (SELECT uid2 FROM friend WHERE uid1 = "+j+")";FB.api({method:"fql.query",query:d,locale:"en_US"},function(a){var c=[];for(var d=0;d<a.length;d++)a.hasOwnProperty(d)&&c.push(a[d].uid);SNAPI.getZIDs(c,SNAPI.FACEBOOK,function(e){var f={};for(d=0;d<c.length;d++){if(e[c[d]]===undefined)continue;f[e[c[d]]]=m(a[d],e[c[d]])}b&&b(f)})})}else FB.api("/"+j+"/friends?fields=id",function(a){if(a.data){var c=a.data,d=[];for(var e=0;e<c.length;e++)c.hasOwnProperty(e)&&d.push(c[e].id);SNAPI.getZIDs(d,SNAPI.FACEBOOK,function(a){var c=[];for(var d in a)a.hasOwnProperty(d)&&c.push(a[d]);b&&b(c)})}else b({})})},SNAPI.Wrappers.Facebook.api["friends.get"]=function(a,b){var c={zid:SNAPI.getCurrentUser(),info:a.info};SNAPI.Wrappers.Facebook.api["friends.getFacebookNeighbors"](c,function(d){SNAPI.enableZfriends?SNAPI.Wrappers.Facebook.api["friends.getZyngaNeighbors"](c,function(c){var e=d;if(!a.info){var f=d.join(",")+",";for(var g=0;g<c.length;g++)f.indexOf(c[g]+",")===-1&&e.push(c[g]);b(e)}else{for(zid in c)c.hasOwnProperty(zid)&&(d.hasOwnProperty(zid)||(e[zid]=c[zid]));b(e)}}):b(d)})},SNAPI.Wrappers.Facebook.api["friends.getAppUsers"]=function(a,b){var c={zid:SNAPI.getCurrentUser(),info:a.info},d={data:SNAPI.JSON.stringify(c),method:"friends.getAppUsers",success:function(a){b(a)},error:function(a,c,d){b("There is an connection error sending request to SNAPI_PROXY page.")}};SNAPI.Wrappers.Facebook.handleAjax(d)},SNAPI.Wrappers.Facebook.api["friends.getNonAppUsers"]=function(a,b){var c={zid:SNAPI.getCurrentUser(),info:a.info},d={data:SNAPI.JSON.stringify(c),method:"friends.getNonAppUsers",success:function(a){b(a)},error:function(a,c,d){b("There is an connection error sending request to SNAPI_PROXY page.")}};SNAPI.Wrappers.Facebook.handleAjax(d)},SNAPI.Wrappers.Facebook.api["user.likes"]=function(a,b){FB.api("/me/likes",function(a){a.error_code?b(undefined,a.error_msg):b(a)})},SNAPI.Wrappers.Facebook.api["stream.get"]=function(a,b){FB.api("/me/home",function(a){if(a.error)b("Type: "+a.error.type+" \nMessage: "+a.error.message);else{var c={};if(a.data){var d=[];for(var e in a.data)if(a.data.hasOwnProperty(e)){var f=a.data[e],g=f.id||"";c[g]={id:g,picture:f.picture||"",link:f.link||"",name:f.name||"",description:f.description||"",attribution:f.attribution||"",actor_name:f.from.name||"",actor_pic:f.from.name||"",date:f.created_time||"",comments:f.comments},d.push(f.from.id)}SNAPI.getZIDs(d,SNAPI.FACEBOOK,function(a){var e=0;for(var f in c)c.hasOwnProperty(f)&&(c[f].zid=a[d[e++]]);b&&b(c)})}else b&&b(c)}})},SNAPI.Wrappers.Facebook.api["stream.publish.v1"]=function(a,b){var c={format:a.format?a.format:"JSON",message:a.message?a.message:"",attachment:a.attachment?a.attachment:null,action_links:a.action_links?a.action_links:[],user_message_prompt:a.user_message_prompt?a.user_message_prompt:" ",target_id:a.target_id?a.target_id:null,uid:a.uid?a.uid:null,method:"stream.publish"},d=function(){return FB.JSON.stringify(this)};for(var e in c)c[e]&&(c[e].toString=d);var f=[];c.uid&&f.push(c.uid),c.target_id&&f.push(c.target_id),SNAPI.getSNUIDs(f,SNAPI.FACEBOOK,function(a){c.uid=c.uid?a[c.uid]:null,c.target_id=c.target_id?a[c.target_id]:null,FB.ui(c,b)})},SNAPI.Wrappers.Facebook.api["stream.publish"]=function(a,b){var c=SNAPI.allGetter(SNAPI.FACEBOOK,"isZfeedShadowEnabled"),d=SNAPI.Wrappers.Facebook.api["friends.getFacebookNeighbors"];d({info:!1},function(d){var e=typeof a.payload=="string"?SNAPI.JSON.parse(a.payload):a.payload;e.feed_type=="wall-to-wall"&&e.targetZid!=SNAPI.getCurrentUserId()&&!o(e.targetZid,d)?SNAPI.Wrappers.Facebook.zfeedsPublish(a,b):SNAPI.Wrappers.Facebook.fbPublish(a,function(d){if(d&&!d.error_code&&c){var e=function(b){SNAPI.fireShadowResultEvent("stream.publish",b.hasOwnProperty("error")?!1:!0,b,a)};a.source_feedId=d.post_id,SNAPI.Wrappers.Facebook.zfeedsPublish(a,e)}b(d)})})};var p=function(a){var b=function(){SNAPI.Events.HideFlash.fire({state:a,elem:{}})};return b},q=p("opened"),r=p("closed");SNAPI.Wrappers.Facebook.zfeedsPublish=function(a,b){var c=a.payload;typeof c=="string"&&(c=SNAPI.JSON.parse(c)),c.feed_type="game-feed";var d="";c.hasOwnProperty("full")?c.full.hasOwnProperty("title")&&(d=c.full.title):d=c.simple.title,SNAPI.parseSNMLName(d,function(d){c.hasOwnProperty("full")?c.full.hasOwnProperty("title")&&(c.full.title=d):c.simple.title=d,a.payload=c,DAPI.api.send({method:"stream.publish",payload:a,callback:b})})},SNAPI.Wrappers.Facebook.fbPublish=function(a,b){if(a.hasOwnProperty("attachment"))return SNAPI.Wrappers.Facebook.api["stream.publish.v1"](a,b);var c=!1,d="",e="",f=null,g=null,h="",i="",j=!1,k=null,l=null,m=null,n=null,o="full",p=[],s=SNAPI.JSON.stringify(a.payload);if(s=="null")b("Type: json payload not found");else{typeof a.payload=="string"?n=SNAPI.JSON.parse(a.payload):n=a.payload,n.zid!==undefined?p.push(n.zid):(p.push(SNAPI.getCurrentUserId()),n.zid=SNAPI.getCurrentUserId());if(n.hasOwnProperty("targetZid")&&n.hasOwnProperty("feed_type")&&n.feed_type=="wall-to-wall")p.push(n.targetZid);else{if(n.hasOwnProperty("targetZid")&&n.hasOwnProperty("feed_type")&&n.feed_type!="wall-to-wall"){b("You specified a target zid and feed type is not wall to wall");return}p.push(SNAPI.getCurrentUserId())}n.hasOwnProperty("auto_publish")&&(j=n.auto_publish),SNAPI.getSNUIDs(p,SNAPI.FACEBOOK,function(a){k=n.hasOwnProperty("targetZid")?a[n.targetZid]:null,l=n.hasOwnProperty("zid")?a[n.zid]:null;if(!l||n.hasOwnProperty("targetZid")&&!k)b("Type: mapping issue with the ids");else{if(!n.hasOwnProperty("simple")&&n.full.buttons&&n.full.buttons.length>1){b("Type: You chose not to degrade");return}c=!0,c&&(o="simple",d=n[o].hasOwnProperty("message")?n[o].message:n.full.hasOwnProperty("message")?n.full.message:"");if(d.length>420){b("Error: Facebook enforces strict limit of 420 characters for message");return}if(n.hasOwnProperty("feed_type")&&n.feed_type=="status-update"){var p=d;FB.api({method:"users.setStatus",status:p,uid:l},function(a){b(a)});return}if(!n[o].hasOwnProperty("description")||n[o].hasOwnProperty("description")&&n[o].description.length>1e3){b("Error: description not specified or description exceeds the limit of 1000 characters for description");return}e=n[o].description;if(!n[o].hasOwnProperty("title")){b("Type: the title is missing");return}if(!n[o].hasOwnProperty("media")){b("Type: media is a required field ");return}n[o].buttons[0].hasOwnProperty("text")?(h=n[o].buttons[0].text,i=n[o].buttons[0].href):n[o].buttons[0].hasOwnProperty("text_short")?(h=n[o].buttons[0].text_short,i=n[o].buttons[0].href):(h=n.simple.buttons[0].text,i=n.simple.buttons[0].href),i=SNAPI.wrapLinks(i),n[o].hasOwnProperty("caption")&&(f=n[o].caption),n.hasOwnProperty("property")&&(g=n.property,g.hasOwnProperty("category")&&g.category.hasOwnProperty("href")&&(g.category.href=SNAPI.wrapLinks(g.category.href)));var s=n[o].media;for(var t=0;t<s.length;t++)s[t].href=SNAPI.wrapLinks(s[t].href);if(n[o].hasOwnProperty("title_href")){m=SNAPI.wrapLinks(n[o].title_href);if(m.length>1024){b("Error: href cannot be longer than 1024 characters");return}}var u="";n[o].hasOwnProperty("ref")&&(u=n[o].ref);var v=null;n[o].hasOwnProperty("title")&&(v=n[o].title);var w=SNAPI.allGetter(SNAPI.FACEBOOK,"graphFeed")?!0:!1;if(SNAPI.getSNID()!=SNAPI.FACEBOOK){var x=SNAPI.getAllConnections(),y=x[SNAPI.getSNID()];w=y&&y.facebook&&y.facebook.graphFeed?!0:!1}var z={};if(!w)z={method:"stream.publish",target_id:k,uid:l,message:d,attachment:{name:v,href:m,caption:f,properties:g,description:e,media:n[o].media},action_links:[{text:h,href:i}],user_message_prompt:n.hasOwnProperty("user_message_prompt")?n.user_message_prompt:null,ref:u};else{z={method:"feed",from:l,to:k,link:m,name:v,caption:f,description:e,properties:g,actions:[{name:h,link:i}],message:d,ref:u};if(s&&s.length){var A=-1,B=-1;for(var t=s.length-1;t>=0;t--)s[t].type==="image"?A=t:B=t;A>=0&&(z.picture=s[A].src,B>=0&&(z.source=s[B].src))}}var C=function(){return FB.JSON.stringify(this)};if(j&&w){var D=k?k:"me";FB.api(D+"/feed","post",z,function(a){a.hasOwnProperty("id")&&(a.post_id=a.id,delete a.id),b(a)})}else if(j)FB.api(z,b);else{for(var E in z)z[E]&&(z[E].toString=C);var F=FB.ui(z,function(a){typeof a=="undefined"&&r(),b(a)});F.subscribe("iframe_show",q),F.subscribe("iframe_hide",r)}}})}},SNAPI.Wrappers.Facebook.api["stream.like"]=function(a,b){if(!a.feed_id)b("Error: missing feed id");else{var c=a.feed_id;FB.api("/"+c+"/likes","post",function(a){a.error?b("Type: "+a.error.type+" \nMessage: "+a.error.message):b(a)})}},SNAPI.Wrappers.Facebook.api["stream.unlike"]=function(a,b){if(!a.feed_id)b("Error: missing feed id");else{var c=a.feed_id;FB.api("/"+c+"/likes","delete",function(a){a.error?b("Type: "+a.error.type+" \nMessage: "+a.error.message):b(a)})}},SNAPI.Wrappers.Facebook.api["stream.publishComment"]=function(a,b){if(!a.feed_id)b("Error: missing feed id");else{var c=a.feed_id,e=d.t("Main","publishSampleComment");a.payload&&(e=a.payload),FB.api("/"+c+"/comments","post",{message:e},function(a){a.error?b("Type: "+a.error.type+" \nMessage: "+a.error.message):b(a)})}},SNAPI.Wrappers.Facebook.api["stream.deleteComment"]=function(a,b){if(!a.comment_id)b("Error: missing comment id");else{var c=a.comment_id,d=a.feed_id?a.feed_id:null;a.feed_id||(d=c.substring(0,c.lastIndexOf("_")-1)),FB.api("/"+c,"delete",function(a){a.error?b("Type: "+a.error.type+" \nMessage: "+a.error.message):b(a)})}},SNAPI.Wrappers.Facebook.api["stream.getComment"]=function(a,b){if(!a.feed_id)b("Error: missing feed id");else{var c=a.feed_id;FB.api("/"+c+"/comments",function(a){a.error?b("Type: "+a.error.type+" \nMessage: "+a.error.message):b(a)})}},SNAPI.Wrappers.Facebook.api["stream.getSingle"]=function(a,b){if(!a.feed_id)b("Error: missing feed id");else{var c=a.feed_id;FB.api("/"+c,function(a){if(a.error)b("Type: "+a.error.type+" \nMessage: "+a.error.message);else{var c={};if(a){var d=[],e=a,f=e.id||"";c[f]={id:f,picture:e.picture||"",link:e.link||"",name:e.name||"",description:e.description||"",attribution:e.attribution||"",actor_name:e.from.name||"",actor_pic:e.from.name||"",date:e.created_time||"",comments:e.comments},d.push(e.from.id),SNAPI.getZIDs(d,SNAPI.FACEBOOK,function(a){var e=0;for(var f in c)c.hasOwnProperty(f)&&(c[f].zid=a[d[e++]]);b&&b(c)})}else a===!1&&b(!1)}})}},SNAPI.Wrappers.Facebook.api["stream.delete"]=function(a,b){if(!a.feed_id)b("Error: missing feed id");else{var c=a.feed_id;FB.api("/"+c,"delete",function(a){a.error?b("Type: "+a.error.type+" \nMessage: "+a.error.message):b(a)})}},SNAPI.Wrappers.Facebook.api["stream.statusUpdate"]=function(a,b){var c,e,f,g=[];a.uid||(e=SNAPI.getCurrentUserId(),g.push(e)),a.message?c=a.message:c=d.t("Main","updateSampleState"),SNAPI.getSNUIDs(g,SNAPI.FACEBOOK,function(a){a[e]?(f=a[e],FB.api({method:"users.setStatus",status:c,uid:f},function(a){b(a)})):b("Error: ZID -> FBID mapping issue")})},SNAPI.Wrappers.Facebook.sendRequestToFB=function(a,b){function f(b,c){var e=FB.ui(b,function(b){typeof b=="undefined"&&r();if(!b||!b.request_ids&&!b.request)return d(null);var e=[];b.request_ids?e=b.request_ids:b.request&&b.to&&(e={request:b.request,to:b.to}),a.data.request_ids=e,delete a.fromZid;var f={gameId:a.gameId,toZid:a.toZid,type:a.type,data:a.data,eventTypeId:a.eventTypeId},g={snId:SNAPI.FACEBOOK,data:SNAPI.JSON.stringify(f),method:"request.send",success:function(a){c(a)},error:function(a,b,c){d("There is an connection error sending request to SNAPI_PROXY page.")}};SNAPI.Wrappers.Facebook.handleAjax(g)});e.subscribe("iframe_show",q),e.subscribe("iframe_hide",r)}function d(a){a&&SNAPI.Logger.error(a),b(a)}var c=Object.prototype.toString.call(a.toZid)!=="[object Array]"?1:a.toZid.length;a.type=a.type||"other";if(Object.prototype.toString.call(a.toZid)!=="[object Array]")SNAPI.Logger.error("The toZid parameter for Facebook request.send API should be an array."),b("The toZid parameter for Facebook request.send API should be an array.");else{if(!a.eventTypeId){SNAPI.Logger.error("The eventTypeId parameters for Facebook request.send API is not defined!"),b("The eventTypeId parameters for Facebook request.send API is not defined!");return}if(Object.prototype.toString.call(a.data)!=="[object Object]"){SNAPI.Logger.error("The data parameter for Facebook request.send API should be an object."),b("The data parameter for Facebook request.send API should be an object.");return}if(!a.data.title||!a.data.body){SNAPI.Logger.error("The title / body field of data for Facebook request.send API is not defined!"),b("The title / body field of data for Facebook request.send API is not defined!");return}var e={method:"apprequests",message:a.data.body,title:a.data.title};SNAPI.getSNUIDs(a.toZid,SNAPI.FACEBOOK,function(c){e.to=[];for(var g=0;g<a.toZid.length;++g)c[a.toZid[g]]?e.to.push(c[a.toZid[g]]):SNAPI.Logger.error("Error: ZID -> FBID mapping issue.");e.to.length!==0?f(e,b):d("ZID->FBID mapping failed.")})}},SNAPI.Wrappers.Facebook.sendRequestToZGN=function(a,b){var c={gameId:a.gameId,toZid:a.toZid,type:a.type||"other",data:a.data,eventTypeId:a.eventTypeId},d={data:SNAPI.JSON.stringify(c),method:"request.send",snId:SNAPI.ZGN,success:function(a){b(a)},error:function(a,c,d){b(!1)}};SNAPI.Wrappers.Facebook.handleAjax(d)},SNAPI.Wrappers.Facebook.api["request.send"]=function(a,b){var c=SNAPI.Wrappers.Facebook.sendRequestToZGN,d=SNAPI.Wrappers.Facebook.api["friends.getFacebookNeighbors"];d({info:!1},function(d){var e=[],f=[];for(var g=0;g<a.toZid.length;g++){var h=!1;for(var i=0;i<d.length;i++)if(a.toZid[g]==d[i]){e.push(a.toZid[g]),h=!0;break}h||f.push(a.toZid[g])}var j=SNAPI.Wrappers.Facebook.sendRequestToFB;if(f.length>0&&e.length>0){var k;a.toZid=e,j(a,function(d){k=d,a.toZid=f,c(a,function(a){k||(k={},k[SNAPI.ZGN]={});if(a){var c=typeof k[SNAPI.ZGN]!="undefined";for(var d in a)c?k[SNAPI.ZGN][d]=a[d]:k[d]=a[d]}b(k)})})}else f.length>0?(a.toZid=f,c(a,function(a){a?b(a):b(!1)})):e.length>0&&(a.toZid=e,j(a,b))})},SNAPI.Wrappers.Facebook.api["request.get"]=function(a,b){delete a.zid;var c={data:SNAPI.JSON.stringify(a),method:"request.get",success:b};SNAPI.Wrappers.Facebook.handleAjax(c)},SNAPI.Wrappers.Facebook.api["request.delete"]=function(a,b){delete a.zid;var c={data:SNAPI.JSON.stringify(a),method:"request.delete",success:b};SNAPI.Wrappers.Facebook.handleAjax(c)};var s=function(){var b=SNAPI.getElementsByTagNameNS("fb","serverFbml");for(var c=0;c<b.length;c++){var d=a(b[c]),e=d.html();e.indexOf('<script type="text/fbml">')==-1&&d.html('<script type="text/fbml">'+d.html()+"</script>")}FB.XFBML.parse()};SNAPI.Wrappers.Facebook.acquireParsingLock=function(){c++},SNAPI.Wrappers.Facebook.releaseParsingLock=function(){c--,c===0&&s()},SNAPI.Wrappers.Facebook.widgets={_updateSessionInformation:function(){SNAPI.getSNID()==SNAPI.ZGN&&DAPI.ui("checkSession");return},serverSnml:function(b,c){SNAPI.Wrappers.Facebook.widgets._updateSessionInformation();var d=a(b),e=c.width||d.parent().width();d.html('<fb:serverFbml width="'+e+'"'+"><fb:fbml>"+d.html()+"</fb:fbml></fb:serverFbml>")},iframe:function(b,c){function e(a){return function(){setTimeout(a,0)}}b=a(b);var d=a("<iframe></iframe>");for(var f in c)if(f=="iframe_onload"&&c[f]!==""){var g=c[f];d.load(e(g))}else c.hasOwnProperty(f)&&d.attr(f,c[f]);b.replaceWith(d);return!0},"request-form":function(b,c){SNAPI.Wrappers.Facebook.widgets._updateSessionInformation();var d=a(b),e="",f=SNAPI.getElementsByTagNameNS("snml","content",b)[0];if(typeof f!="undefined"){var g=SNAPI.getElementsByTagNameNS("snml","req-choice",f),h=[];for(var i=0;i<g.length;i++)h.push(g[i]);while(h.length!==0){var j=h.shift(),k=SNAPI.wrapLinks(j.getAttribute("url")),l=j.getAttribute("label");e+='<fb:req-choice url="'+k+'" label="'+l+'">',f.removeChild(j)}e=e.replace(/"/g,"'"),e=(f.innerText||f.textContent)+e,b.removeChild(f)}var m=SNAPI.getElementsByTagNameNS("snml","token",b),n=m.length;while(n!==0)a(m[n-1]).remove(),n=n-1;var o=a(b);o.replaceWith('<fb:request-form action="'+(c.action||"")+'" '+'method="'+(c.method||"POST")+'" '+'invite="'+(c.invite||"true")+'" '+'type="'+(c.type||"")+'" '+(e?'content="'+e+'"':"")+">"+o.html()+"</fb:request-form>")},"multi-friend-selector":function(b,c){function m(){var b=parseInt(c.rows,10),e=parseInt(c.cols,10);l.html('<fb:multi-friend-selector cols="'+c.cols+'" '+'condensed="'+c.condensed+'" '+'max="'+c.max+'" '+'unselected_rows="'+c.unselected_rows+'" '+'selected_rows="'+c.selected_rows+'" '+'email_invite="'+c.email_invite+'" '+'bypass="skip" '+'rows="'+b+'" '+'cols="'+e+'" '+'exclude_ids="'+h+'" '+'actiontext="'+c.actiontext+'" '+'import_external_friends="'+c.import_external_friends+'"></fb:multi-friend-selector>'),c.condensed==="true"&&(l.append('<fb:request-form-submit import_external_friends="'+c.import_external_friends+'"></fb:request-form-submit>'),j&&(l=a('<a style="'+k+'" href="'+i+'">'+d.t("Main","mfsSkipButton")+"</a>").appendTo(l)))}SNAPI.Wrappers.Facebook.widgets._updateSessionInformation();var e=[],f=[],g=[],h="",i="",j=!1,k=!1,l=a("<div></div>");a(b).replaceWith(l),c.hasOwnProperty("skip_action")&&c.skip_action&&(i=c.skip_action,i.charAt(i.length-1)==="/"&&(i=i.substr(0,i-1)),i.indexOf("?")===-1?i+="?skip=1":i+="&skip=1",j=!0,c.skip_style?k=c.skip_style:k="background-color:#3B5998; border-color:#D9DFEA #0E1F5B #0E1F5B #D9DFEA; border-style:solid; border-width:1px; color:#FFFFFF; cursor:pointer; margin-right:10px; outline-style:none; padding:4px 10px; text-decoration:none; vertical-align:middle;direction:ltr; font-family:lucida grande; font-size:11px;");if(typeof c.import_external_friends=="undefined"||c.import_external_friends==="")c.import_external_friends="false";c.exclude_ids?(e=c.exclude_ids.split(","),SNAPI.Wrappers.Facebook.acquireParsingLock(),SNAPI.getSNUIDs(e,SNAPI.FACEBOOK,function(a){for(var b in a)a.hasOwnProperty(b)&&a[b]!="undefined"&&(h+=a[b]+", ");h&&(h=h.slice(0,-2)),m(),SNAPI.Wrappers.Facebook.releaseParsingLock()})):m()},"profile-pic":function(b,c){function g(d){var g=d[f];c.linked=="true"?e=a('<div><a target="_top" href="//www.facebook.com/profile.php?id='+g+'">'+'<img src="//graph.facebook.com/'+g+"/picture?type="+c.size+'"'+(c.width!==null?' width="'+c.width+'"':"")+(c.height!==null?' height="'+c.height+'"':"")+" /></a></div>"):e=a('<div><img src="//graph.facebook.com/'+g+"/picture?type="+c.size+'"'+(c.width!==null?' width="'+c.width+'"':"")+(c.height!==null?' height="'+c.height+'"':"")+" /></div>"),a(b).replaceWith(e)}var d,e,f=c.uid||0;f!==0?SNAPI.getSNUIDs([f],SNAPI.FACEBOOK,g):g({0:j})},name:function(b,c){function g(e){var g=e[f],h=a("<div></div>"),i="";FB.api("/"+g,function(e){c.hasOwnProperty("firstnameonly")?i=e.first_name:c.lastnameonly?i=e.last_name:c.hasOwnProperty("useyou")&&c.useyou!==""&&e.id==g?c.capitalize?i=d.t("Main","nameYouCaps"):i=d.t("Main","nameYouLower"):i=e.first_name,c.linked?a(b).replaceWith('<div><a target="_top" href="http://www.facebook.com/profile.php?id='+g+'">'+i+"</a></div>"):a(b).replaceWith("<div><b>"+i+"</b></div>")})}var e,f=c.uid||0;f!==0?SNAPI.getSNUIDs([f],SNAPI.FACEBOOK,g):g({0:j})},"request-button":function(b,c){SNAPI.Wrappers.Facebook.widgets._updateSessionInformation();if(typeof c.import_external_friends=="undefined"||c.import_external_friends==="")c.import_external_friends="false";if(c.uid)SNAPI.Wrappers.Facebook.acquireParsingLock(),SNAPI.getSNUIDs([c.uid],SNAPI.FACEBOOK,function(d){var e=a('<fb:request-form-submit import_external_friends="'+c.import_external_friends+'"></fb:request-form-submit>');d.hasOwnProperty(c.uid)&&(e.attr("uid",d[c.uid]),e.attr("label",c.label)),a(b).replaceWith(e),SNAPI.Wrappers.Facebook.releaseParsingLock()});else throw"No UID specified in request-button"},"feed-widget":function(b,c){SNAPI.Wrappers.Facebook.widgets._updateSessionInformation(),a(b).append('<div><fb:serverFbml><fb:fbml><fb:feed title="'+c.title+'" max="'+c.max+'">'+"</fb:feed></fb:fbml></fb:serverFbml></div>")}},SNAPI.Wrappers.Facebook.updateSession=function(a,b){var c={data:SNAPI.JSON.stringify({session:a}),method:"updateSession",success:function(a){b&&b(a),SNAPI.Events.AuthStatusChange.fire(a)}};SNAPI.Wrappers.Facebook.handleAjax(c)},SNAPI.Wrappers.Facebook.connectLogin=function(a){FB.getLoginStatus(function(a){if(a.authResponse)SNAPI.Wrappers.Facebook.updateSession(a.authResponse);else{SNAPI.Events.LoginStatus.fire(a);var b=SNAPI.getReqPerms();FB.login(function(a){a.authResponse&&SNAPI.Wrappers.Facebook.updateSession(a.authResponse)},{scope:b})}})},SNAPI.Wrappers.Facebook.detectLogin=function(){function a(a){a.status=="connected"&&a.authResponse&&SNAPI.Wrappers.Facebook.updateSession(a.authResponse)}FB.Event.subscribe("auth.authResponseChange",a)},SNAPI.Wrappers.Facebook.fbAsyncInit=function(a){function b(a){SNAPI.Events.HideFlash.fire(a)}SNAPI.getRequireLogin()||SNAPI.Wrappers.Facebook.detectLogin(),a.oauth=!0,a.frictionlessRequests===undefined&&(a.frictionlessRequests=!0),a.hideFlashCallback=b;var c=!1;a.session&&a.session.user_id&&a.session.access_token&&(a.authResponse={userID:a.session.user_id,accessToken:a.session.access_token},c=!0),FB.init(a),SNAPI.getRequireLogin()?(SNAPI.Wrappers.Facebook.ui.requireSession({},function(){c||SNAPI.loaded(SNAPI.FACEBOOK)}),c&&SNAPI.loaded(SNAPI.FACEBOOK)):SNAPI.loaded(SNAPI.FACEBOOK)}}(SNAPI.jQuery),SNAPI.getSNID()==SNAPI.FACEBOOK&&SNAPI.Wrappers.Facebook.onClientLoad(function(){var a=SNAPI.getConfig(SNAPI.FACEBOOK);SNAPI.Wrappers.Facebook.fbAsyncInit(a)}),define("Facebook/wrapper",function(){})