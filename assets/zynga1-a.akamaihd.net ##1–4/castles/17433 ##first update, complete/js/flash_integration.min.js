$(window).load(function(){var a=$("#flashapp")[0];var b=function(c){var d=0;if(c.wheelDelta){d=c.wheelDelta/120;if(window.opera){d=-d}}else{if(c.detail){d=-c.detail*3}}this.onMouseWheel&&this.onMouseWheel(d);c.stopPropagation();c.preventDefault()};if(a){if(a.addEventListener){a.addEventListener("DOMMouseScroll",b,false);a.addEventListener("mousewheel",b,false)}else{if(a.attachEvent){a.attachEvent("onmousewheel",b)}}}$("#z_lang").bind("hide_z_lang",function(){hideScreenshot()});$("#z_lang").bind("show_z_lang",function(){showScreenshot(0.25,3,805306368)});startSnapiRequestFBDialogCheck()});var fbDialogTimerId=0;var fbDialogIsShowing=false;function startSnapiRequestFBDialogCheck(){if(fbDialogTimerId==0){fbDialogTimerId=setInterval(function(){var e=false;var a=document.getElementById("fb-root");if(a){var d=a.childNodes;for(var c=0;c<d.length;c++){var b=d[c];if(b.offsetTop>=0&&$(b).hasClass("fb_dialog")){e=true;break}}}if(e&&!fbDialogIsShowing){fbDialogIsShowing=true;showScreenshot(0.25,3,805306368)}else{if(!e&&fbDialogIsShowing){fbDialogIsShowing=false;hideScreenshot()}}},250)}}function stopSnapiRequestFBDialogCheck(){clearInterval(fbDialogTimerId);fbDialogTimerId=0;if(fbDialogIsShowing){fbDialogIsShowing=false;hideScreenshot()}}function enableAllInput(){document.getElementById("flashapp").enableAllInput()}function disableAllInput(){document.getElementById("flashapp").disableAllInput()}function getAppFriendIds(){return g_appFriendIds}function getFriendData(){return g_friendData}function getUserInfo(){return g_userInfo}function getExperiments(){return g_experiments}var g_appRequestParams;var g_requestPayload;var g_requestCallback=null;function snapiRequestCallback(a){document.getElementById("flashapp").requestCallback(a)}function snapiRequestDone(a){if(!g_requestCallback){if(a!=null){document.getElementById("flashapp").requestDone(a)}else{document.getElementById("flashapp").onViralCanceled()}}else{g_requestCallback(a)}}function snapiRequestSNUID(a){if(!a||a.length==0){FB.ui({method:"apprequests",message:g_requestPayload.body,title:g_requestPayload.title,filter:["app_users"]},snapiRequestDone)}else{if(a.length>1){FB.ui({method:"apprequests",message:g_requestPayload.body,title:g_requestPayload.title,to:a},snapiRequestDone)}else{FB.ui({method:"apprequests",message:g_requestPayload.body,title:g_requestPayload.title,to:a[0]},snapiRequestDone)}}}function snapiSendRequestOld(b,e,c,a){var d=[];d.toZid=b;d.eventTypeId=c;d.data=e;g_requestPayload=e;if(!b){snapiRequestSNUID(b)}SNAPI.getSNUIDs(b,SNAPI.FACEBOOK,function(h){var i=[];for(var g=0;g<b.length;++g){h[b[g]]?i.push(h[b[g]]):SNAPI.Logger.error("Error: ZID -> FBID mapping issue.")}snapiRequestSNUID(i)})}function snapiSendRequest(b,f,c,a){var d={gameId:g_gameId,toZid:b,type:a,data:f,eventTypeId:c};try{SNAPI.api("request.send",d,snapiRequestDone)}catch(g){document.getElementById("flashapp").onRequestError(g)}}function snapiGiftBack(b,d,c,e){var a=[b];if(e){g_requestCallback=e}snapiSendRequest(a,d,c,"gift")}var g_giftBackVid;var g_giftTo;var g_canvasUrl;var g_viralName;function giftBackCallback(a){if(a!=null){window.top.location=g_canvasUrl+"index.php?va=giftback&gbvid="+g_giftBackVid+"&giftTo="+g_giftTo+"&gbReq="+a[g_giftTo]+"&gbName="+g_viralName}else{window.top.location=g_canvasUrl+"index.php"}}function sendGiftBack(f,b,e,c,d){g_giftTo=f;g_giftBackVid=b;g_canvasUrl=d;g_gameId=c;var a=JSON.parse(e);g_viralName=a.viralName;snapiGiftBack(f,a,14000,giftBackCallback)}function snapiGetPermission(a,b,c){SNAPI.api("users.getPermissions",{uid:b},function(d){var e="0";if(d[b]){if(d[b][a]){e=d[b][a]}}var f=document.getElementById("flashapp");f[c](b,a,e=="1")})}function snapiStreamPublish(b){var d=[b.full.media];b.full.media=d;b.simple.media=d;var f={payload:JSON.stringify(b)};try{var a=SNAPI.api("stream.publish",f,function(e){if(e){document.getElementById("flashapp").onViralPublished(e)}else{document.getElementById("flashapp").onViralCanceled()}})}catch(c){document.getElementById("flashapp").onViralError()}}function snapiAwardXp(a){try{SNAPI.api("points.grantXP",a)}catch(b){}}function movie(a){return document[a]}function embedGameSwf(f,d,g,h){var e="10.2.0";var c={allowScriptAccess:"always",wmode:"window",allowFullScreen:"true"};var i={id:"flashapp",name:"flashapp"};var l=swfobject.getFlashPlayerVersion();var k=l.major+"."+l.minor+"."+l.release;var a={channel:"flash_version",category:k};var j=g_callbackURL+"/ztrack/ztrack_flash.php?zaspSessionKey="+h.zaspSessionKey+"&zyAuthHash="+h.zyAuthHash+"&zySig="+h.zySig;$.ajax({url:j,data:a,success:""});if(swfobject.hasFlashPlayerVersion(e)){var b=swfobject.embedSWF(f,"flashContent","100%",g,e,"playerProductInstall.swf",h,c,i)}else{if(k=="0.0.0"){}else{$("#upgradeFlashLink").click(function(){sendVersionStats("upgrade");swfobject.embedSWF(f,"flashContent","100%",g,e,"playerProductInstall.swf",h,c,i)});$("#loadingPlaceholder").hide();$("#upgradeFlashPlaceholder").show()}}}function openZSC(){if(SNAPI_ENABLE&&ZSC_ENABLE){initZsc();SNAPI.ZSC.addOnOpenedListener(function(){showScreenshot(0.25,3,805306368)});SNAPI.ZSC.addOnClosedListener(function(){hideScreenshot()})}}var ZCastleTabs=(function(){var a={};a.click=function(b){var c=document.getElementById("flashapp");if(typeof c.tabClick=="function"){c.tabClick(b)}};return a})();var ZTrackQuery=(function(){var b={};var a=new Array();var c=null;b.GetKey=function(e,f){var d=g_callbackURL+"/ztrack/ztrack_callback.php";c=f;$.ajax({url:d,data:e,success:b.KeyReceived})};b.KeyReceived=function(e){var f=document.getElementById("flashapp");if(!f){alert("Could not find flash client")}if(c!=null&&typeof f[c]=="function"){if(e!=null){var d={result:"Success",key:e.key,keyMsgCtr:e.keyMsgCtr};f[c](d)}else{var d={result:"Error",message:"no Key returned"};f[c](d)}}else{alert("Flash client callback not found")}};return b})();function getZTrackKey(e,d,h,c,b,a,g){var f={channel:e,category:d,subcategory:h,family:c,genus:b,userId:a};ZTrackQuery.GetKey(f,g)}function TestZTrackCall(){var a={};ZTrackQuery.GetKey(a)}var CastlePayments=(function(){var d={};d.addToCart=function(n,o,i){if(n==0){return}if(o==0){return}if(typeof g_paymentHashes[n]=="undefined"){return}var r=223;var k=SNAPI.getSNID();var m=SNAPI.getConfig(k).session.user_id;var h=1;var g=n;var q=o;var f=c;var j=b;var l=i;var p=SNAPI.getCurrentGameId(k);var s=g_paymentHashes[n];ZPURCHASE.add_to_cart(r,k,m,h,g,q,f,j,l,p,s)};var c=function(){};var b=function(){};d.openOffers=function(){var h=223;var j=SNAPI.getSNID();var g=SNAPI.getConfig(j).session.user_id;var f=1;var i=SNAPI.getCurrentGameId(j);ZPAYMENTS.get_offers(h,j,g,f,e,a,i)};var e=function(f){if(f){}else{}};var a=function(f){};return d})();var ZscClientNotif=(function(){var a={};var b=new Array();a.Accept=function(c){var d=new Array(c.viralName,c.contextVars);b.push(d)};a.ProcessRequests=function(){var f=false;for(var c=0;c<b.length;c++){var d=new Array();d.push(b[c][0]);d.push(b[c][1]);var e=document.getElementById("flashapp");if(e&&e.onZscEvent&&typeof e.onZscEvent=="function"){e.onZscEvent(d)}f=true}if(f){var e=document.getElementById("flashapp");if(e&&e.processRequests&&typeof e.processRequests=="function"){e.processRequests()}}b=[]};return a})();var ZscClientNotifAccept=ZscClientNotif.Accept;