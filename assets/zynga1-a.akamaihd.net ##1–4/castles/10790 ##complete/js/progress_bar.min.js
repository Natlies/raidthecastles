function ProgressBar(b,a){this.initUrl=b;this.updateUrl=a;this.socialBar=$("#socialBar");this.progressBar=$("#progressBar");this.countdown=$("#socialBarCountdown");this.callout=$("#socialBarCallout");this.complete=$("#socialBarComplete");this.fanBox=$("#fanBox");this.steps={bookmarked:$("#pBarStepBookmark"),fan:$("#pBarStepFan"),email:$("#pBarStepSubscribe"),publish_stream:$("#pBarStepPublish")};$.getJSON(ZY.PrepareURL(this.initUrl),bind(this.update,this));this.attachClickListeners()}ProgressBar.prototype={attachClickListeners:function(){var a=this;$("#pBarStepBookmark .pBarAction a").click(function(){showBookmarkDialog(bind(a.trackProgressBar,a));return false});$("#pBarStepFan .pBarAction a").click(bind(this.fanPopupClicked,this));$("#pBarStepSubscribe .pBarAction a").click(function(){showEmailPermission(bind(a.trackProgressBar,a));return false});$("#pBarStepPublish .pBarAction a").click(function(){showStreamPermissions(bind(a.trackProgressBar,a));return false});$("#closeFanBox").click(bind(this.closeFanPopup,this))},trackProgressBar:function(){$.getJSON(ZY.PrepareURL(this.updateUrl),bind(this.update,this))},update:function(d){if(d.completed){if(this.socialBar.is(":visible")){this.complete.show()}this.socialBar.hide();this.callout.hide()}else{this.socialBar.show();this.callout.show();var c=1,b=[124,256,386,515,648];for(var a in this.steps){if(d[a]==1){this.steps[a].addClass("done");++c}else{this.steps[a].removeClass("done")}}this.progressBar.css("width",b[c-1]+"px").addClass("percent_"+(c*20));this.countdown.text(5-c)}},fanPopupClicked:function(){this.fanBox.show();return false},closeFanPopup:function(){this.fanBox.hide();this.trackProgressBar();return false}};